import{b as X,_ as ne,$ as oe,r as A,e as o,c as y,m as t,k as a,x as d,w as Z,E as f,G as se,z as ue,I as H,J as K,y as Q,B as de,A as W,O as ce,v as Y,o as ie,j as V,t as p,C as r,q,u as G,F as I,Z as N,S as pe,X as re,U as _e,a1 as me}from"./.pnpm-fc_Lr1wI.js";import{i as h}from"./index-CtYSmbnK.js";import{f as O}from"./format-DaCfCw6f.js";import{_ as fe}from"./_plugin-vue_export-helper-DlAUqK2U.js";const ye=u=>h.post("/admin/account",u),ve=u=>h.get(`/admin/account?page=${u.page}&size=${u.size}`),ke=u=>h.patch(`/admin/account/${u.id}`,u),ge=u=>h.patch("/admin/account/info",{account_ids:[u.id]}),Ve=u=>h.patch("/admin/account/info",{account_ids:u}),be=u=>h.delete("/admin/account",{data:{account_ids:[u.id]}}),Ae=u=>h.delete("/admin/account",{data:{account_ids:u}}),J=u=>h.patch("/admin/account/switch",u),he=u=>h.get(`/admin/account/ban?account_id=${u.id}`),xe=X({__name:"AddAccount",props:{modelValue:{},modelModifiers:{}},emits:ne(["getAccounts"],["update:modelValue"]),setup(u,{emit:c}){const U=c,C=oe(u,"modelValue"),x=A(!1),_=A({type:1,cookie:""}),v=A(null),D={cookie:[{required:!0,message:"请输入账户信息",trigger:"blur"}]},L=async $=>{if(!(!$||!await $.validate()))try{x.value=!0,(await ye(_.value)).data.have_repeat&&f.info("存在重复的账号,已自动过滤"),f.success("添加成功")}finally{x.value=!1}},B=$=>{U("getAccounts"),$()},F=()=>{C.value=!1,U("getAccounts")};return($,k)=>{const M=se,b=ue,z=H,S=K,w=Q,s=de,l=W,m=ce,i=Y;return o(),y(m,{title:"添加账号",width:"60%",modelValue:C.value,"onUpdate:modelValue":k[5]||(k[5]=g=>C.value=g),"before-close":B},{footer:t(()=>[a(l,{type:"info",onClick:k[3]||(k[3]=g=>F())},{default:t(()=>[d("取消")]),_:1}),a(l,{type:"primary",onClick:k[4]||(k[4]=g=>L(v.value))},{default:t(()=>[d("添加")]),_:1})]),default:t(()=>[Z((o(),y(s,{ref_key:"addAccountFormRef",ref:v,model:_.value,rules:D,"label-width":"auto"},{default:t(()=>[a(b,{label:"提示"},{default:t(()=>[a(M,null,{default:t(()=>[d("可以使用换行来分割多个账号")]),_:1})]),_:1}),a(b,{label:"账号类型"},{default:t(()=>[a(S,{modelValue:_.value.type,"onUpdate:modelValue":k[0]||(k[0]=g=>_.value.type=g)},{default:t(()=>[a(z,{label:"cookie",value:1}),a(z,{label:"token",value:2})]),_:1},8,["modelValue"])]),_:1}),_.value.type===1?(o(),y(b,{key:0,label:"Cookie",prop:"cookie"},{default:t(()=>[a(w,{type:"textarea",modelValue:_.value.cookie,"onUpdate:modelValue":k[1]||(k[1]=g=>_.value.cookie=g)},null,8,["modelValue"])]),_:1})):(o(),y(b,{key:1,label:"refresh_token",prop:"cookie"},{default:t(()=>[a(w,{type:"textarea",modelValue:_.value.cookie,"onUpdate:modelValue":k[2]||(k[2]=g=>_.value.cookie=g)},null,8,["modelValue"])]),_:1}))]),_:1},8,["model"])),[[i,x.value]])]),_:1},8,["modelValue"])}}}),Ce={key:0},$e={key:0},Ue={key:0},ze={key:0},Se={key:0},we={key:0},Ee={key:0},Ie={key:0},De={key:0},Le=X({__name:"AccountManagement",setup(u){const c=A(!1),U=A(15),C=A(1),x=A(),_=A([]),v=async()=>{try{c.value=!0;const s=await ve({page:C.value,size:U.value});s.data.data=s.data.data.map(l=>(l.switch=!!l.switch,l)),x.value=s.data}finally{c.value=!1}},D=async s=>{try{c.value=!0,await ge(s),f.success("更新账户信息成功")}finally{c.value=!1,await v()}},L=async()=>{try{c.value=!0;const s=_.value.map(l=>l.id);await Ve(s),f.success("批量更新账户成功")}finally{c.value=!1,await v()}},B=async s=>{try{c.value=!0,await be(s),f.success("删除账户成功")}finally{c.value=!1,await v()}},F=async()=>{try{c.value=!0;const s=_.value.map(l=>l.id);await Ae(s),f.success("批量删除账户成功")}finally{c.value=!1,await v()}},$=async()=>{try{c.value=!0;const s=_.value.map(l=>l.id);await J({account_ids:s,switch:1}),f.success("批量启用账户成功")}finally{c.value=!1,await v()}},k=async()=>{try{c.value=!0;const s=_.value.map(l=>l.id);await J({account_ids:s,switch:0}),f.success("批量禁用账户成功")}finally{c.value=!1,await v()}},M=s=>_.value=s;ie(v);const b=A(!1),z=()=>b.value=!b.value,S=async s=>{if(s.edit=!s.edit,s.edit===!1)try{c.value=!0,await ke(s),f.success("修改賬號成功")}finally{c.value=!1,await v()}},w=async s=>{try{c.value=!0;const l=await he(s);if(l.data.errno===0){const m=l.data.anti;f.success("获取封禁信息成功"),m.ban_status?(f.success("封禁状态：已封禁"),f.success(`封禁开始时间: ${new Date(parseInt(`${m.start_time}000`)).toLocaleString()}`),f.success(`封禁结束时间: ${new Date(parseInt(`${m.end_time}000`)).toLocaleString()}`),f.success(`已被封禁${m.ban_times}次`),f.success(`封禁原因: ${m.ban_reason}`)):f.success("封禁状态：未封禁")}else l.data.errno===-6?f.warning("获取封禁信息失败,Cookie或AccessToken已过期"):f.warning(`获取封禁信息失败,code:${l.data.errno},msg:${l.data.errmsg}`)}finally{c.value=!1}};return(s,l)=>{var P,R,j;const m=W,i=pe,g=Q,E=H,T=K,ee=re,te=_e,ae=me,le=Y;return o(),V(I,null,[a(xe,{onGetAccounts:v,modelValue:b.value,"onUpdate:modelValue":l[0]||(l[0]=e=>b.value=e)},null,8,["modelValue"]),a(m,{type:"primary",onClick:l[1]||(l[1]=e=>v())},{default:t(()=>[d("刷新列表")]),_:1}),a(m,{type:"primary",onClick:l[2]||(l[2]=e=>z())},{default:t(()=>[d("添加账号")]),_:1}),a(m,{type:"primary",disabled:_.value.length<=0,onClick:l[3]||(l[3]=e=>L())},{default:t(()=>[d(" 批量更新信息 ")]),_:1},8,["disabled"]),a(m,{type:"primary",disabled:_.value.length<=0,onClick:l[4]||(l[4]=e=>$())},{default:t(()=>[d(" 批量启用 ")]),_:1},8,["disabled"]),a(m,{type:"primary",disabled:_.value.length<=0,onClick:l[5]||(l[5]=e=>k())},{default:t(()=>[d(" 批量禁用 ")]),_:1},8,["disabled"]),a(m,{type:"danger",disabled:_.value.length<=0,onClick:l[6]||(l[6]=e=>F())},{default:t(()=>[d(" 批量删除 ")]),_:1},8,["disabled"]),Z((o(),y(te,{data:((P=x.value)==null?void 0:P.data)??[],border:"","show-overflow-tooltip":"",class:"table",onSelectionChange:M},{default:t(()=>[a(i,{type:"selection",fixed:"",width:"40"}),a(i,{prop:"id",label:"ID",fixed:""}),a(i,{prop:"baidu_name",label:"百度用户名",width:"150px"},{default:t(({row:e})=>[e.edit?r("",!0):(o(),V("span",Ce,p(e.baidu_name),1)),e.edit?(o(),y(g,{key:1,modelValue:e.baidu_name,"onUpdate:modelValue":n=>e.baidu_name=n},null,8,["modelValue","onUpdate:modelValue"])):r("",!0)]),_:1}),a(i,{prop:"today_size",label:"今日解析",width:"150px"},{default:t(({row:e})=>[q("span",null,p(e.today_count)+" ("+p(G(O)(e.today_size??0))+")",1)]),_:1}),a(i,{prop:"today_size",label:"总共解析",width:"150px"},{default:t(({row:e})=>[q("span",null,p(e.total_count)+" ("+p(G(O)(e.total_size??0))+")",1)]),_:1}),a(i,{prop:"account_type",label:"账号类型",width:"160px"},{default:t(({row:e})=>[e.edit?r("",!0):(o(),V("span",$e,p(e.account_type),1)),e.edit?(o(),y(T,{key:1,modelValue:e.account_type,"onUpdate:modelValue":n=>e.account_type=n},{default:t(()=>[(o(),V(I,null,N(["cookie","access_token"],n=>a(E,{key:n,value:n},{default:t(()=>[d(p(n),1)]),_:2},1032,["value"])),64))]),_:2},1032,["modelValue","onUpdate:modelValue"])):r("",!0)]),_:1}),a(i,{prop:"cookie",label:"Cookie",width:"150px"},{default:t(({row:e})=>[e.edit?r("",!0):(o(),V("span",Ue,p(e.cookie),1)),e.edit?(o(),y(g,{key:1,modelValue:e.cookie,"onUpdate:modelValue":n=>e.cookie=n},null,8,["modelValue","onUpdate:modelValue"])):r("",!0)]),_:1}),a(i,{prop:"access_token",label:"access_token",width:"150px"},{default:t(({row:e})=>[e.edit?r("",!0):(o(),V("span",ze,p(e.access_token),1)),e.edit?(o(),y(g,{key:1,modelValue:e.access_token,"onUpdate:modelValue":n=>e.access_token=n},null,8,["modelValue","onUpdate:modelValue"])):r("",!0)]),_:1}),a(i,{prop:"refresh_token",label:"refresh_token",width:"150px"},{default:t(({row:e})=>[e.edit?r("",!0):(o(),V("span",Se,p(e.refresh_token),1)),e.edit?(o(),y(g,{key:1,modelValue:e.refresh_token,"onUpdate:modelValue":n=>e.refresh_token=n},null,8,["modelValue","onUpdate:modelValue"])):r("",!0)]),_:1}),a(i,{prop:"expired_at",label:"token过期时间",width:"160px"},{default:t(({row:e})=>[d(p(e.expired_at?new Date(e.expired_at).toLocaleString():"非token模式"),1)]),_:1}),a(i,{prop:"vip_type",label:"会员类型",width:"130px"},{default:t(({row:e})=>[e.edit?r("",!0):(o(),V("span",we,p(e.vip_type),1)),e.edit?(o(),y(T,{key:1,modelValue:e.vip_type,"onUpdate:modelValue":n=>e.vip_type=n},{default:t(()=>[(o(),V(I,null,N(["超级会员","假超级会员","普通会员","普通用户"],n=>a(E,{key:n,value:n},{default:t(()=>[d(p(n),1)]),_:2},1032,["value"])),64))]),_:2},1032,["modelValue","onUpdate:modelValue"])):r("",!0)]),_:1}),a(i,{prop:"switch",label:"状态",width:"70px"},{default:t(({row:e})=>[e.edit?r("",!0):(o(),V("span",Ee,p(e.switch?"启用":"禁用"),1)),e.edit?(o(),y(ee,{key:1,modelValue:e.switch,"onUpdate:modelValue":n=>e.switch=n},null,8,["modelValue","onUpdate:modelValue"])):r("",!0)]),_:1}),a(i,{prop:"prov",label:"省份",width:"120px"},{default:t(({row:e})=>[e.edit?r("",!0):(o(),V("span",Ie,p(e.prov??"未使用"),1)),e.edit?(o(),y(T,{key:1,modelValue:e.prov,"onUpdate:modelValue":n=>e.prov=n},{default:t(()=>[(o(),y(E,{key:null,value:null},{default:t(()=>[d("未使用")]),_:1})),(o(),V(I,null,N(["北京市","天津市","上海市","重庆市","河北省","山西省","内蒙古自治区","辽宁省","吉林省","黑龙江省","江苏省","浙江省","安徽省","福建省","江西省","山东省","河南省","湖北省","湖南省","广东省","广西壮族自治区","海南省","四川省","贵州省","云南省","西藏自治区","陕西省","甘肃省","青海省","宁夏回族自治区","新疆维吾尔自治区","香港特别行政区","澳门特别行政区","台湾省"],n=>a(E,{key:n,label:n,value:n},null,8,["label","value"])),64))]),_:2},1032,["modelValue","onUpdate:modelValue"])):r("",!0)]),_:1}),a(i,{prop:"reason",label:"禁用原因",width:"150px"},{default:t(({row:e})=>[e.edit?r("",!0):(o(),V("span",De,p(e.reason??"未禁用"),1)),e.edit?(o(),y(g,{key:1,modelValue:e.reason,"onUpdate:modelValue":n=>e.reason=n},null,8,["modelValue","onUpdate:modelValue"])):r("",!0)]),_:1}),a(i,{prop:"svip_end_at",label:"超级会员结束时间",width:"160px"},{default:t(({row:e})=>[d(p(new Date(e.svip_end_at).toLocaleString()),1)]),_:1}),a(i,{prop:"last_use_at",label:"上次使用时间",width:"160px"},{default:t(({row:e})=>[d(p(new Date(e.last_use_at).toLocaleString()),1)]),_:1}),a(i,{prop:"created_at",label:"创建时间",width:"160px"},{default:t(({row:e})=>[d(p(new Date(e.created_at).toLocaleString()),1)]),_:1}),a(i,{prop:"updated_at",label:"更新时间",width:"160px"},{default:t(({row:e})=>[d(p(new Date(e.updated_at).toLocaleString()),1)]),_:1}),a(i,{width:"350",label:"操作",fixed:"right"},{default:t(({row:e})=>[a(m,{size:"small",type:"primary",onClick:n=>D(e)},{default:t(()=>[d("更新信息")]),_:2},1032,["onClick"]),a(m,{size:"small",type:"primary",onClick:n=>w(e)},{default:t(()=>[d(" 检查封禁状态 ")]),_:2},1032,["onClick"]),e.edit?r("",!0):(o(),y(m,{key:0,size:"small",type:"primary",onClick:n=>S(e)},{default:t(()=>[d(" 編輯 ")]),_:2},1032,["onClick"])),e.edit?(o(),y(m,{key:1,size:"small",type:"primary",onClick:n=>S(e)},{default:t(()=>[d(" 完成 ")]),_:2},1032,["onClick"])):r("",!0),a(m,{size:"small",type:"danger",onClick:n=>B(e)},{default:t(()=>[d("删除")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[le,c.value]]),a(ae,{"current-page":C.value,"onUpdate:currentPage":l[7]||(l[7]=e=>C.value=e),"page-size":U.value,"onUpdate:pageSize":l[8]||(l[8]=e=>U.value=e),"page-sizes":[15,50,100,500,((R=x.value)==null?void 0:R.total)??100],total:((j=x.value)==null?void 0:j.total)??100,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:v,onCurrentChange:v},null,8,["current-page","page-size","page-sizes","total"])],64)}}}),Ne=fe(Le,[["__scopeId","data-v-75eadf50"]]);export{Ne as default};
