import{E as D,l as ee,b as te,c as le,d as oe,e as se,a as ae,v as re}from"./element-plus@2.7.7_vue@3.4.32_typescript@5.5.3_-4orX1JGZ.js";import{u as ne}from"./fileListStore-CBP9MskC.js";import{u as ie,a as ue,c as T,g as I}from"./index-B22sOAcu.js";import{c as de}from"./copy-By2guqEs.js";import{f as N}from"./format-CyW-QbYa.js";import{i as pe}from"./isMobile-BD0f7XPI.js";import{s as Z}from"./pinia@2.1.7_typescript@5.5.3_vue@3.4.32_typescript@5.5.3_-BSzeUtha.js";import{u as me}from"./vue-router@4.4.0_vue@3.4.32_typescript@5.5.3_-ByijA4Eg.js";import{d as ce,m as fe,n as _e,I as ge,o as r,G as d,H as a,a as g,K as m,c as V,L as v,i as n,F as $}from"./@vue_runtime-core@3.4.32-BofAHbgu.js";import{r as C,u as e}from"./@vue_reactivity@3.4.32-DksAu7zd.js";import{L as y}from"./@vue_shared@3.4.32-CaCWPAm8.js";import{_ as ve}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./@vue_runtime-dom@3.4.32-DNdjNMzo.js";import"./lodash-es@4.17.21-BB-zMWwC.js";import"./async-validator@4.2.5-DKvM95Vc.js";import"./@vueuse_core@9.13.0_vue@3.4.32_typescript@5.5.3_-DkVRVfGD.js";import"./@vueuse_shared@9.13.0_vue@3.4.32_typescript@5.5.3_-BbpdFR9m.js";import"./dayjs@1.11.11-Ct2Knyoi.js";import"./@element-plus_icons-vue@2.3.1_vue@3.4.32_typescript@5.5.3_-x2o2c_8n.js";import"./@ctrl_tinycolor@3.6.1-r5W6hzzQ.js";import"./@sxzz_popperjs-es@2.11.7-D9SI2xQl.js";import"./normalize-wheel-es@1.2.0-B6fDCfyv.js";import"./axios@1.7.2-B4uVmeYG.js";import"./vue-demi@0.14.8_vue@3.4.32_typescript@5.5.3_-Dq6ymT-8.js";const ye={key:0},ke={key:1},we=["src"],be=ce({__name:"GetFileList",setup(Ve){const M=C("right");pe()&&(M.value="top");const k=ne(),{pending:G,getFileListForm:o,getFileListFormRef:S,selectedRows:P,limitForm:_,limitMessage:U,vcode:w,downloadLinks:E,dialogVisible:q}=Z(k),B=ie(),{config:f}=Z(B),H=(l,t,i)=>t===""?i(new Error("请先输入需要解析的链接")):x(t)?i():i(new Error("请输入合法的链接")),K=()=>{o.value.dir="/",o.value.surl="";const l=x(o.value.url);l&&(l.id&&(l.surl?(o.value.url=`https://pan.baidu.com/share/init?surl=${l.id}`,o.value.surl=`1${l.id}`):(o.value.url=`https://pan.baidu.com/s/${l.id}`,o.value.surl=l.id)),l.pwd&&(o.value.pwd=l.pwd,D.success("已自动填写密码")))},x=l=>{const t=l.match(/s\/([a-zA-Z0-9_-]+)/),i=l.match(/surl=([a-zA-Z0-9_-]+)/),p=l.match(/\?pwd=([a-zA-Z0-9_-]+)/),u=l.match(/&pwd=([a-zA-Z0-9_-]+)/),c=l.match(/提取码[:：]\s?([a-zA-Z0-9_-]+)/);let b;if(i)b=i[1];else if(t)b=t[1];else return!1;const L=p?p[1]:u?u[1]:c?c[1]:null;return i?{surl:!0,id:b,pwd:L}:{id:b,pwd:L}},j={url:[{required:!0,validator:H,trigger:"blur"}]},J=async l=>{if(!l||!await l.validate())return;const t=new URLSearchParams;t.set("url",o.value.url),t.set("surl",o.value.surl),t.set("pwd",o.value.pwd),t.set("dir",o.value.dir),de(`${location.host}/?${t.toString()}`,"复制成功")};fe(()=>{_e(()=>{const l=new URLSearchParams(location.search);if(l.size<4)return;const t=l.get("url"),i=l.get("pwd"),p=l.get("dir"),u=l.get("surl");!t||!i||!p||!u||(o.value={url:t,pwd:i,dir:p,surl:u},D.success("已读取到参数,正在加载"),setTimeout(k.getFileList,500))}),k.getLimit(),z()});const A=me(),O=()=>A.push("/login"),Q=()=>A.push("/admin"),W=l=>window.open(l),R=C(0),z=()=>R.value=Date.now(),h=()=>E.value=[],F=C(!1),X=()=>{o.value.token!==""?F.value=!0:F.value=!1,k.getLimit()};return(l,t)=>{const i=ee,p=te,u=le,c=oe,b=se,L=ae,Y=re;return ge((r(),d(L,null,{default:a(()=>[g("h2",null,"前台解析中心 | "+y(e(ue)()),1),e(f).show_copyright?(r(),d(i,{key:0,"show-icon":"",type:"warning",closable:!1,title:e(f).custom_copyright},null,8,["title"])):m("",!0),e(f).have_account?(r(),d(i,{key:1,closable:!1,class:"alert",title:"当前中转账号充足",type:"success"})):(r(),d(i,{key:2,closable:!1,class:"alert",title:"当前中转账号不足",type:"error"})),e(f).debug?(r(),d(i,{key:3,class:"alert",title:"当前网站开启了DEBUG模式,非调试请关闭!!!!",type:"error",closable:!1})):m("",!0),e(f).is_https?m("",!0):(r(),d(i,{key:4,class:"alert",title:"当前网站未开启SSL,可能出现无法请求Aria2服务器的问题",type:"error",closable:!1})),e(U)===""?(r(),d(i,{key:5,class:"alert",type:"success",closable:!1},{default:a(()=>[F.value?(r(),V("span",ye,[g("span",null,"当前卡密: "+y(e(_).group_name),1),g("span",null,"剩余可解析文件数: "+y(e(_).count),1),g("span",null,"剩余可解析大小: "+y(e(N)(e(_).size)),1),g("span",null," 到期时间: "+y(e(_).expired_at==="未使用"?e(_).expired_at:new Date(e(_).expired_at??0).toLocaleString()),1)])):(r(),V("span",ke,[g("span",null,"当前用户组: "+y(e(_).group_name),1),g("span",null,"剩余可解析文件数: "+y(e(_).count),1),g("span",null,"剩余可解析大小: "+y(e(N)(e(_).size)),1)]))]),_:1})):(r(),d(i,{key:6,class:"alert",type:"error",closable:!1},{default:a(()=>[v(y(e(U)??"未知错误"),1)]),_:1})),n(b,{ref_key:"getFileListFormRef",ref:S,model:e(o),rules:j,"label-width":"auto",class:"form","label-position":M.value},{default:a(()=>[n(u,{label:"链接",prop:"url"},{default:a(()=>[n(p,{modelValue:e(o).url,"onUpdate:modelValue":t[0]||(t[0]=s=>e(o).url=s),modelModifiers:{trim:!0},onChange:t[1]||(t[1]=s=>h()),onBlur:t[2]||(t[2]=s=>K())},null,8,["modelValue"])]),_:1}),n(u,{label:"密码",prop:"pwd"},{default:a(()=>[n(p,{modelValue:e(o).pwd,"onUpdate:modelValue":t[3]||(t[3]=s=>e(o).pwd=s),modelModifiers:{trim:!0},onChange:t[4]||(t[4]=s=>h())},null,8,["modelValue"])]),_:1}),e(f).need_password?(r(),d(u,{key:0,label:"解析密码",prop:"password"},{default:a(()=>[n(p,{modelValue:e(o).password,"onUpdate:modelValue":t[5]||(t[5]=s=>e(o).password=s),modelModifiers:{trim:!0}},null,8,["modelValue"])]),_:1})):m("",!0),e(f).token_mode?(r(),d(u,{key:1,label:"卡密(不用留空即可)",prop:"token"},{default:a(()=>[n(p,{modelValue:e(o).token,"onUpdate:modelValue":t[6]||(t[6]=s=>e(o).token=s),modelModifiers:{trim:!0},onBlur:X},null,8,["modelValue"])]),_:1})):m("",!0),n(u,{label:"当前路径",prop:"dir"},{default:a(()=>[n(p,{modelValue:e(o).dir,"onUpdate:modelValue":t[7]||(t[7]=s=>e(o).dir=s),disabled:""},null,8,["modelValue"])]),_:1}),e(w).hit_captcha?(r(),V($,{key:2},[n(u,{label:"验证码编号",prop:"vcode_str"},{default:a(()=>[n(p,{modelValue:e(w).vcode_str,"onUpdate:modelValue":t[8]||(t[8]=s=>e(w).vcode_str=s),disabled:""},null,8,["modelValue"])]),_:1}),n(u,{label:"验证码图片",prop:"vcode_img"},{default:a(()=>[g("img",{src:`${e(w).vcode_img}&t=${R.value}`,alt:"验证码图片",onClick:z},null,8,we)]),_:1}),n(u,{label:"验证码字符",prop:"vcode_input"},{default:a(()=>[n(p,{modelValue:e(w).vcode_input,"onUpdate:modelValue":t[9]||(t[9]=s=>e(w).vcode_input=s)},null,8,["modelValue"])]),_:1})],64)):m("",!0),e(T)()==="admin"?(r(),d(u,{key:3,label:"解析账号id,多个使用,分割",prop:"account_ids"},{default:a(()=>[n(p,{modelValue:e(o).account_ids,"onUpdate:modelValue":t[10]||(t[10]=s=>e(o).account_ids=s)},null,8,["modelValue"])]),_:1})):m("",!0),n(u,{label:" ",class:"buttons"},{default:a(()=>[n(c,{type:"primary",onClick:t[11]||(t[11]=s=>e(k).getFileList())},{default:a(()=>[v("获取/刷新列表")]),_:1}),n(c,{type:"primary",disabled:e(P).length<=0,onClick:t[12]||(t[12]=s=>e(k).getDownloadLinks())},{default:a(()=>[v(" 批量解析 ")]),_:1},8,["disabled"]),n(c,{type:"primary",onClick:t[13]||(t[13]=s=>J(e(S)))},{default:a(()=>[v("复制当前地址")]),_:1}),e(E).length!==0?(r(),d(c,{key:0,type:"primary",onClick:t[14]||(t[14]=s=>q.value=!0)},{default:a(()=>[v(" 重新显示下载链接 ")]),_:1})):m("",!0),e(f).button_link!==""?(r(),d(c,{key:1,type:"primary",onClick:t[15]||(t[15]=s=>W(e(f).button_link))},{default:a(()=>[v(" 前往购买卡密 ")]),_:1})):m("",!0),e(f).show_login_button?(r(),V($,{key:2},[e(I)()==="0"?(r(),d(c,{key:0,type:"primary",onClick:t[16]||(t[16]=s=>O())},{default:a(()=>[v("登陆")]),_:1})):m("",!0),e(I)()==="1"?(r(),V($,{key:1},[e(T)()==="admin"?(r(),d(c,{key:0,type:"primary",onClick:t[17]||(t[17]=s=>Q())},{default:a(()=>[v(" 进入后台 ")]),_:1})):m("",!0),n(c,{type:"danger",onClick:t[18]||(t[18]=s=>e(B).logout())},{default:a(()=>[v(" 注销 ")]),_:1})],64)):m("",!0)],64)):m("",!0)]),_:1})]),_:1},8,["model","label-position"])]),_:1})),[[Y,e(G)]])}}}),je=ve(be,[["__scopeId","data-v-cd0f8a9c"]]);export{je as default};
