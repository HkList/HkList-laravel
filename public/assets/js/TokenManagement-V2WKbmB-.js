import{b as O,_ as J,$ as Q,r as f,f as v,c as V,n as t,l,x as _,w as c,k as G,F as K,Z as w,E as M,X as h,Y as ee,z as le,W,y as X,B as ae,A as Y,K as te,v as Z,o as ne,q as x,t as z,a0 as g,C as A,N as oe,a2 as ue,P as de,a1 as se}from"./.pnpm-CdrKUIM1.js";import{i as E}from"./index-C7F-zFvO.js";import{_ as ie}from"./_plugin-vue_export-helper-DlAUqK2U.js";const pe=s=>E.post("/admin/token",s),me=s=>E.post("/admin/token/generate",s),re=s=>E.get(`/admin/token?page=${s.page}&size=${s.size}`),ce=s=>E.patch(`/admin/token/${s.id}`,s),_e=s=>E.delete("/admin/token",{data:{token_ids:[s.id]}}),ve=s=>E.delete("/admin/token",{data:{token_ids:s}}),ge=O({__name:"AddToken",props:{modelValue:{},modelModifiers:{}},emits:J(["getTokens"],["update:modelValue"]),setup(s,{emit:m}){const C=m,b=Q(s,"modelValue"),k=f(!1),a=f({type:"single",name:"",count:0,size:0,day:0}),r=f(null),D={name:[{required:!0,message:"请输入卡密名称",trigger:"blur"}],token_count:[{required:!0,message:"请输入卡密个数",trigger:"blur"}],day:[{required:!0,message:"请输入卡密天数",trigger:"blur"}],count:[{required:!0,message:"请输入可下载次数",trigger:"blur"}],size:[{required:!0,message:"请输入可下载大小",trigger:"blur"}]},F=async T=>{if(!(!T||!await T.validate()))try{k.value=!0,a.value.type==="single"?await pe({type:"single",name:a.value.name,count:a.value.count,size:a.value.size,day:a.value.day}):await me({type:"random",token_count:a.value.token_count,count:a.value.count,size:a.value.size,day:a.value.day}),M.success("添加成功")}finally{k.value=!1}},B=T=>{C("getTokens"),T()},q=()=>{b.value=!1,C("getTokens")};return(T,u)=>{const U=h,L=ee,n=le,d=W,y=X,i=ae,S=Y,$=te,N=Z;return v(),V($,{title:"添加卡密",width:"60%",modelValue:b.value,"onUpdate:modelValue":u[8]||(u[8]=o=>b.value=o),"before-close":B},{footer:t(()=>[l(S,{type:"info",onClick:u[6]||(u[6]=o=>q())},{default:t(()=>[_("取消")]),_:1}),l(S,{type:"primary",onClick:u[7]||(u[7]=o=>F(r.value))},{default:t(()=>[_("添加")]),_:1})]),default:t(()=>[c((v(),V(i,{ref_key:"addTokenFormRef",ref:r,model:a.value,rules:D,"label-width":"auto"},{default:t(()=>[l(n,{label:"创建方式",prop:"type"},{default:t(()=>[l(L,{modelValue:a.value.type,"onUpdate:modelValue":u[0]||(u[0]=o=>a.value.type=o)},{default:t(()=>[(v(),G(K,null,w(["single","random"],o=>l(U,{key:o,label:o,value:o},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),l(n,{label:"可用次数",prop:"count"},{default:t(()=>[l(d,{modelValue:a.value.count,"onUpdate:modelValue":u[1]||(u[1]=o=>a.value.count=o)},null,8,["modelValue"])]),_:1}),l(n,{label:"可用天数",prop:"day"},{default:t(()=>[l(d,{modelValue:a.value.day,"onUpdate:modelValue":u[2]||(u[2]=o=>a.value.day=o)},null,8,["modelValue"])]),_:1}),l(n,{label:"可下大小(GB)",prop:"size"},{default:t(()=>[l(d,{modelValue:a.value.size,"onUpdate:modelValue":u[3]||(u[3]=o=>a.value.size=o)},null,8,["modelValue"])]),_:1}),a.value.type==="single"?(v(),V(n,{key:0,label:"卡密名称",prop:"name"},{default:t(()=>[l(y,{modelValue:a.value.name,"onUpdate:modelValue":u[4]||(u[4]=o=>a.value.name=o)},null,8,["modelValue"])]),_:1})):(v(),V(n,{key:1,label:"卡密个数",prop:"token_count"},{default:t(()=>[l(d,{modelValue:a.value.token_count,"onUpdate:modelValue":u[5]||(u[5]=o=>a.value.token_count=o)},null,8,["modelValue"])]),_:1}))]),_:1},8,["model"])),[[N,k.value]])]),_:1},8,["modelValue"])}}}),fe=O({__name:"TokenManagement",setup(s){const m=f(!1),C=f(15),b=f(1),k=f(),a=f([]),r=async()=>{try{m.value=!0;const n=await re({page:b.value,size:C.value});k.value=n.data}finally{m.value=!1}},D=async n=>{n.edit=!(n.edit??!1)},F=async n=>{n.edit=!(n.edit??!0),await B(n)},B=async n=>{try{m.value=!0,await ce(n),M.success("修改卡密成功")}finally{m.value=!1,await r()}},q=async n=>{try{m.value=!0,await _e(n),M.success("删除卡密成功")}finally{m.value=!1,await r()}},T=async()=>{try{m.value=!0;const n=a.value.map(d=>d.id);await ve(n),M.success("删除卡密成功")}finally{m.value=!1,await r()}},u=n=>a.value=n;ne(r);const U=f(!1),L=()=>U.value=!U.value;return(n,d)=>{var I,P,R;const y=Y,i=oe,S=X,$=W,N=ue,o=de,j=se,H=Z;return v(),G(K,null,[l(ge,{onGetTokens:r,modelValue:U.value,"onUpdate:modelValue":d[0]||(d[0]=e=>U.value=e)},null,8,["modelValue"]),l(y,{type:"primary",onClick:d[1]||(d[1]=e=>r())},{default:t(()=>[_("刷新列表")]),_:1}),l(y,{type:"primary",onClick:d[2]||(d[2]=e=>L())},{default:t(()=>[_("添加卡密")]),_:1}),l(y,{type:"danger",disabled:a.value.length<=0,onClick:d[3]||(d[3]=e=>T())},{default:t(()=>[_(" 批量删除 ")]),_:1},8,["disabled"]),c((v(),V(o,{data:((I=k.value)==null?void 0:I.data)??[],border:"","show-overflow-tooltip":"",class:"table",onSelectionChange:u},{default:t(()=>[l(i,{type:"selection",width:"40"}),l(i,{prop:"id",label:"ID"}),l(i,{prop:"name",label:"卡密名称"},{default:t(({row:e})=>[c(x("span",null,z(e.name),513),[[g,!e.edit]]),c(l(S,{modelValue:e.name,"onUpdate:modelValue":p=>e.name=p},null,8,["modelValue","onUpdate:modelValue"]),[[g,e.edit]])]),_:1}),l(i,{prop:"count",label:"可用次数"},{default:t(({row:e})=>[c(x("span",null,z(e.count),513),[[g,!e.edit]]),c(l($,{modelValue:e.count,"onUpdate:modelValue":p=>e.count=p},null,8,["modelValue","onUpdate:modelValue"]),[[g,e.edit]])]),_:1}),l(i,{prop:"size",label:"可下载大小"},{default:t(({row:e})=>[c(x("span",null,z(e.size),513),[[g,!e.edit]]),c(l($,{modelValue:e.size,"onUpdate:modelValue":p=>e.size=p},null,8,["modelValue","onUpdate:modelValue"]),[[g,e.edit]])]),_:1}),l(i,{prop:"day",label:"有效期"},{default:t(({row:e})=>[c(x("span",null,z(e.day),513),[[g,!e.edit]]),c(l($,{modelValue:e.day,"onUpdate:modelValue":p=>e.day=p},null,8,["modelValue","onUpdate:modelValue"]),[[g,e.edit]])]),_:1}),l(i,{prop:"expired_at",label:"到期时间",width:"250"},{default:t(({row:e})=>[c(x("span",null,z(e.expired_at?new Date(e.expired_at).toLocaleString():"未使用"),513),[[g,!e.edit]]),e.edit?(v(),V(N,{key:0,modelValue:e.expired_at,"onUpdate:modelValue":p=>e.expired_at=p,type:"datetime",placeholder:"请选择日期"},null,8,["modelValue","onUpdate:modelValue"])):A("",!0)]),_:1}),l(i,{prop:"created_at",label:"创建时间"},{default:t(({row:e})=>[_(z(new Date(e.created_at).toLocaleString()),1)]),_:1}),l(i,{prop:"updated_at",label:"更新时间"},{default:t(({row:e})=>[_(z(new Date(e.updated_at).toLocaleString()),1)]),_:1}),l(i,{width:"150",label:"操作",fixed:"right"},{default:t(({row:e})=>[e.edit?A("",!0):(v(),V(y,{key:0,size:"small",type:"primary",onClick:p=>D(e)},{default:t(()=>[_(" 编辑 ")]),_:2},1032,["onClick"])),e.edit?(v(),V(y,{key:1,size:"small",type:"primary",onClick:p=>F(e)},{default:t(()=>[_(" 保存 ")]),_:2},1032,["onClick"])):A("",!0),l(y,{size:"small",type:"danger",onClick:p=>q(e)},{default:t(()=>[_("删除")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[H,m.value]]),l(j,{"current-page":b.value,"onUpdate:currentPage":d[4]||(d[4]=e=>b.value=e),"page-size":C.value,"onUpdate:pageSize":d[5]||(d[5]=e=>C.value=e),"page-sizes":[15,50,100,500,((P=k.value)==null?void 0:P.total)??100],total:((R=k.value)==null?void 0:R.total)??100,layout:"sizes, prev, pager, next",onSizeChange:r,onCurrentChange:r},null,8,["current-page","page-size","page-sizes","total"])],64)}}}),be=ie(fe,[["__scopeId","data-v-410e424a"]]);export{be as default};
