import{b as J,_ as le,$ as oe,r as A,e as n,c as m,m as t,k as a,x as s,w as X,E as b,G as ne,z as ue,I as Z,J as H,y as K,B as de,A as Q,O as se,v as W,o as ce,j as V,t as i,C as p,q as j,u as q,F as E,Z as N,S as ie,X as pe,U as _e,a1 as re}from"./.pnpm-fc_Lr1wI.js";import{i as x}from"./index-cxaaF_YQ.js";import{f as G}from"./format-DaCfCw6f.js";import{_ as me}from"./_plugin-vue_export-helper-DlAUqK2U.js";const fe=c=>x.post("/admin/account",c),ye=c=>x.get(`/admin/account?page=${c.page}&size=${c.size}`),ve=c=>x.patch(`/admin/account/${c.id}`,c),ke=c=>x.patch("/admin/account/info",{account_ids:[c.id]}),Ve=c=>x.patch("/admin/account/info",{account_ids:c}),ge=c=>x.delete("/admin/account",{data:{account_ids:[c.id]}}),be=c=>x.delete("/admin/account",{data:{account_ids:c}}),O=c=>x.patch("/admin/account/switch",c),Ae=J({__name:"AddAccount",props:{modelValue:{},modelModifiers:{}},emits:le(["getAccounts"],["update:modelValue"]),setup(c,{emit:_}){const $=_,C=oe(c,"modelValue"),h=A(!1),r=A({type:1,cookie:""}),f=A(null),D={cookie:[{required:!0,message:"请输入账户信息",trigger:"blur"}]},F=async U=>{if(!(!U||!await U.validate()))try{h.value=!0,(await fe(r.value)).data.have_repeat&&b.info("存在重复的账号,已自动过滤"),b.success("添加成功")}finally{h.value=!1}},I=U=>{$("getAccounts"),U()},L=()=>{C.value=!1,$("getAccounts")};return(U,y)=>{const B=ne,g=ue,S=Z,w=H,u=K,o=de,k=Q,d=se,z=W;return n(),m(d,{title:"添加账号",width:"60%",modelValue:C.value,"onUpdate:modelValue":y[5]||(y[5]=v=>C.value=v),"before-close":I},{footer:t(()=>[a(k,{type:"info",onClick:y[3]||(y[3]=v=>L())},{default:t(()=>[s("取消")]),_:1}),a(k,{type:"primary",onClick:y[4]||(y[4]=v=>F(f.value))},{default:t(()=>[s("添加")]),_:1})]),default:t(()=>[X((n(),m(o,{ref_key:"addAccountFormRef",ref:f,model:r.value,rules:D,"label-width":"auto"},{default:t(()=>[a(g,{label:"提示"},{default:t(()=>[a(B,null,{default:t(()=>[s("可以使用换行来分割多个账号")]),_:1})]),_:1}),a(g,{label:"账号类型"},{default:t(()=>[a(w,{modelValue:r.value.type,"onUpdate:modelValue":y[0]||(y[0]=v=>r.value.type=v)},{default:t(()=>[a(S,{label:"cookie",value:1}),a(S,{label:"token",value:2})]),_:1},8,["modelValue"])]),_:1}),r.value.type===1?(n(),m(g,{key:0,label:"Cookie",prop:"cookie"},{default:t(()=>[a(u,{type:"textarea",modelValue:r.value.cookie,"onUpdate:modelValue":y[1]||(y[1]=v=>r.value.cookie=v)},null,8,["modelValue"])]),_:1})):(n(),m(g,{key:1,label:"refresh_token",prop:"cookie"},{default:t(()=>[a(u,{type:"textarea",modelValue:r.value.cookie,"onUpdate:modelValue":y[2]||(y[2]=v=>r.value.cookie=v)},null,8,["modelValue"])]),_:1}))]),_:1},8,["model"])),[[z,h.value]])]),_:1},8,["modelValue"])}}}),he={key:0},xe={key:0},Ce={key:0},Ue={key:0},ze={key:0},$e={key:0},Se={key:0},we={key:0},Ee={key:0},De=J({__name:"AccountManagement",setup(c){const _=A(!1),$=A(15),C=A(1),h=A(),r=A([]),f=async()=>{try{_.value=!0;const u=await ye({page:C.value,size:$.value});u.data.data=u.data.data.map(o=>(o.switch=!!o.switch,o)),h.value=u.data}finally{_.value=!1}},D=async u=>{try{_.value=!0,await ke(u),b.success("更新账户信息成功")}finally{_.value=!1,await f()}},F=async()=>{try{_.value=!0;const u=r.value.map(o=>o.id);await Ve(u),b.success("批量更新账户成功")}finally{_.value=!1,await f()}},I=async u=>{try{_.value=!0,await ge(u),b.success("删除账户成功")}finally{_.value=!1,await f()}},L=async()=>{try{_.value=!0;const u=r.value.map(o=>o.id);await be(u),b.success("批量删除账户成功")}finally{_.value=!1,await f()}},U=async()=>{try{_.value=!0;const u=r.value.map(o=>o.id);await O({account_ids:u,switch:1}),b.success("批量启用账户成功")}finally{_.value=!1,await f()}},y=async()=>{try{_.value=!0;const u=r.value.map(o=>o.id);await O({account_ids:u,switch:0}),b.success("批量禁用账户成功")}finally{_.value=!1,await f()}},B=u=>r.value=u;ce(f);const g=A(!1),S=()=>g.value=!g.value,w=async u=>{if(u.edit=!u.edit,u.edit===!1)try{_.value=!0,await ve(u),b.success("修改賬號成功")}finally{_.value=!1,await f()}};return(u,o)=>{var T,P,R;const k=Q,d=ie,z=K,v=Z,M=H,Y=pe,ee=_e,te=re,ae=W;return n(),V(E,null,[a(Ae,{onGetAccounts:f,modelValue:g.value,"onUpdate:modelValue":o[0]||(o[0]=e=>g.value=e)},null,8,["modelValue"]),a(k,{type:"primary",onClick:o[1]||(o[1]=e=>f())},{default:t(()=>[s("刷新列表")]),_:1}),a(k,{type:"primary",onClick:o[2]||(o[2]=e=>S())},{default:t(()=>[s("添加账号")]),_:1}),a(k,{type:"primary",disabled:r.value.length<=0,onClick:o[3]||(o[3]=e=>F())},{default:t(()=>[s(" 批量更新信息 ")]),_:1},8,["disabled"]),a(k,{type:"primary",disabled:r.value.length<=0,onClick:o[4]||(o[4]=e=>U())},{default:t(()=>[s(" 批量启用 ")]),_:1},8,["disabled"]),a(k,{type:"primary",disabled:r.value.length<=0,onClick:o[5]||(o[5]=e=>y())},{default:t(()=>[s(" 批量禁用 ")]),_:1},8,["disabled"]),a(k,{type:"danger",disabled:r.value.length<=0,onClick:o[6]||(o[6]=e=>L())},{default:t(()=>[s(" 批量删除 ")]),_:1},8,["disabled"]),X((n(),m(ee,{data:((T=h.value)==null?void 0:T.data)??[],border:"","show-overflow-tooltip":"",class:"table",onSelectionChange:B},{default:t(()=>[a(d,{type:"selection",fixed:"",width:"40"}),a(d,{prop:"id",label:"ID",fixed:""}),a(d,{prop:"baidu_name",label:"百度用户名",width:"150px"},{default:t(({row:e})=>[e.edit?p("",!0):(n(),V("span",he,i(e.baidu_name),1)),e.edit?(n(),m(z,{key:1,modelValue:e.baidu_name,"onUpdate:modelValue":l=>e.baidu_name=l},null,8,["modelValue","onUpdate:modelValue"])):p("",!0)]),_:1}),a(d,{prop:"today_size",label:"今日解析",width:"150px"},{default:t(({row:e})=>[j("span",null,i(e.today_count)+" ("+i(q(G)(e.today_size??0))+")",1)]),_:1}),a(d,{prop:"today_size",label:"总共解析",width:"150px"},{default:t(({row:e})=>[j("span",null,i(e.total_count)+" ("+i(q(G)(e.total_size??0))+")",1)]),_:1}),a(d,{prop:"account_type",label:"账号类型",width:"160px"},{default:t(({row:e})=>[e.edit?p("",!0):(n(),V("span",xe,i(e.account_type),1)),e.edit?(n(),m(M,{key:1,modelValue:e.account_type,"onUpdate:modelValue":l=>e.account_type=l},{default:t(()=>[(n(),V(E,null,N(["cookie","access_token"],l=>a(v,{key:l,value:l},{default:t(()=>[s(i(l),1)]),_:2},1032,["value"])),64))]),_:2},1032,["modelValue","onUpdate:modelValue"])):p("",!0)]),_:1}),a(d,{prop:"cookie",label:"Cookie",width:"150px"},{default:t(({row:e})=>[e.edit?p("",!0):(n(),V("span",Ce,i(e.cookie),1)),e.edit?(n(),m(z,{key:1,modelValue:e.cookie,"onUpdate:modelValue":l=>e.cookie=l},null,8,["modelValue","onUpdate:modelValue"])):p("",!0)]),_:1}),a(d,{prop:"access_token",label:"access_token",width:"150px"},{default:t(({row:e})=>[e.edit?p("",!0):(n(),V("span",Ue,i(e.access_token),1)),e.edit?(n(),m(z,{key:1,modelValue:e.access_token,"onUpdate:modelValue":l=>e.access_token=l},null,8,["modelValue","onUpdate:modelValue"])):p("",!0)]),_:1}),a(d,{prop:"refresh_token",label:"refresh_token",width:"150px"},{default:t(({row:e})=>[e.edit?p("",!0):(n(),V("span",ze,i(e.refresh_token),1)),e.edit?(n(),m(z,{key:1,modelValue:e.refresh_token,"onUpdate:modelValue":l=>e.refresh_token=l},null,8,["modelValue","onUpdate:modelValue"])):p("",!0)]),_:1}),a(d,{prop:"expired_at",label:"token过期时间",width:"160px"},{default:t(({row:e})=>[s(i(e.expired_at?new Date(e.expired_at).toLocaleString():"非token模式"),1)]),_:1}),a(d,{prop:"vip_type",label:"会员类型",width:"130px"},{default:t(({row:e})=>[e.edit?p("",!0):(n(),V("span",$e,i(e.vip_type),1)),e.edit?(n(),m(M,{key:1,modelValue:e.vip_type,"onUpdate:modelValue":l=>e.vip_type=l},{default:t(()=>[(n(),V(E,null,N(["超级会员","假超级会员","普通会员","普通用户"],l=>a(v,{key:l,value:l},{default:t(()=>[s(i(l),1)]),_:2},1032,["value"])),64))]),_:2},1032,["modelValue","onUpdate:modelValue"])):p("",!0)]),_:1}),a(d,{prop:"switch",label:"状态",width:"70px"},{default:t(({row:e})=>[e.edit?p("",!0):(n(),V("span",Se,i(e.switch?"启用":"禁用"),1)),e.edit?(n(),m(Y,{key:1,modelValue:e.switch,"onUpdate:modelValue":l=>e.switch=l},null,8,["modelValue","onUpdate:modelValue"])):p("",!0)]),_:1}),a(d,{prop:"prov",label:"省份",width:"120px"},{default:t(({row:e})=>[e.edit?p("",!0):(n(),V("span",we,i(e.prov??"未使用"),1)),e.edit?(n(),m(M,{key:1,modelValue:e.prov,"onUpdate:modelValue":l=>e.prov=l},{default:t(()=>[(n(),m(v,{key:null,value:null},{default:t(()=>[s("未使用")]),_:1})),(n(),V(E,null,N(["北京市","天津市","上海市","重庆市","河北省","山西省","内蒙古自治区","辽宁省","吉林省","黑龙江省","江苏省","浙江省","安徽省","福建省","江西省","山东省","河南省","湖北省","湖南省","广东省","广西壮族自治区","海南省","四川省","贵州省","云南省","西藏自治区","陕西省","甘肃省","青海省","宁夏回族自治区","新疆维吾尔自治区","香港特别行政区","澳门特别行政区","台湾省"],l=>a(v,{key:l,label:l,value:l},null,8,["label","value"])),64))]),_:2},1032,["modelValue","onUpdate:modelValue"])):p("",!0)]),_:1}),a(d,{prop:"reason",label:"禁用原因",width:"150px"},{default:t(({row:e})=>[e.edit?p("",!0):(n(),V("span",Ee,i(e.reason??"未禁用"),1)),e.edit?(n(),m(z,{key:1,modelValue:e.reason,"onUpdate:modelValue":l=>e.reason=l},null,8,["modelValue","onUpdate:modelValue"])):p("",!0)]),_:1}),a(d,{prop:"svip_end_at",label:"超级会员结束时间",width:"160px"},{default:t(({row:e})=>[s(i(new Date(e.svip_end_at).toLocaleString()),1)]),_:1}),a(d,{prop:"last_use_at",label:"上次使用时间",width:"160px"},{default:t(({row:e})=>[s(i(new Date(e.last_use_at).toLocaleString()),1)]),_:1}),a(d,{prop:"created_at",label:"创建时间",width:"160px"},{default:t(({row:e})=>[s(i(new Date(e.created_at).toLocaleString()),1)]),_:1}),a(d,{prop:"updated_at",label:"更新时间",width:"160px"},{default:t(({row:e})=>[s(i(new Date(e.updated_at).toLocaleString()),1)]),_:1}),a(d,{width:"220",label:"操作",fixed:"right"},{default:t(({row:e})=>[a(k,{size:"small",type:"primary",onClick:l=>D(e)},{default:t(()=>[s("更新信息")]),_:2},1032,["onClick"]),e.edit?p("",!0):(n(),m(k,{key:0,size:"small",type:"primary",onClick:l=>w(e)},{default:t(()=>[s(" 編輯 ")]),_:2},1032,["onClick"])),e.edit?(n(),m(k,{key:1,size:"small",type:"primary",onClick:l=>w(e)},{default:t(()=>[s(" 完成 ")]),_:2},1032,["onClick"])):p("",!0),a(k,{size:"small",type:"danger",onClick:l=>I(e)},{default:t(()=>[s("删除")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[ae,_.value]]),a(te,{"current-page":C.value,"onUpdate:currentPage":o[7]||(o[7]=e=>C.value=e),"page-size":$.value,"onUpdate:pageSize":o[8]||(o[8]=e=>$.value=e),"page-sizes":[15,50,100,500,((P=h.value)==null?void 0:P.total)??100],total:((R=h.value)==null?void 0:R.total)??100,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:f,onCurrentChange:f},null,8,["current-page","page-size","page-sizes","total"])],64)}}}),Me=me(De,[["__scopeId","data-v-0ce37547"]]);export{Me as default};
