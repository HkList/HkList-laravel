import{b as x,J as b,o as N,K as Z,E as $,u as D,w as I,e as t,f as d,c as p,n as i,q as T,t as G,B as _,l as a,s as g,L as P,x as q,y as J,z as K,A as j,p as H,v as O}from"./.pnpm-Ddnih9Rt.js";import{u as Q}from"./fileListStore-DloV4jeg.js";import{u as W,a as X,g as M}from"./index-B8uUd9en.js";import{c as Y}from"./copy-DC3YnA_v.js";import{f as ee}from"./format-DaCfCw6f.js";import{_ as te}from"./_plugin-vue_export-helper-DlAUqK2U.js";const le=x({__name:"GetFileList",setup(re){const f=Q(),{pending:S,getFileListForm:r,getFileListFormRef:L,selectedRows:h,limitForm:v,hitLimit:k}=b(f),V=W(),{config:w}=b(V),E=(l,e,o)=>e===""?o(new Error("请先输入需要解析的链接")):F(e)?o():o(new Error("请输入合法的链接")),A=()=>{r.value.dir="/",r.value.surl="";const l=F(r.value.url);l&&(l.id&&(l.surl?r.value.url=`https://pan.baidu.com/share/init?surl=${l.id}`:r.value.url=`https://pan.baidu.com/s/${l.id}`,r.value.surl=l.id),l.pwd&&(r.value.pwd=l.pwd,$.success("已自动填写密码")))},F=l=>{const e=l.match(/s\/([a-zA-Z0-9_-]+)/),o=l.match(/surl=([a-zA-Z0-9_-]+)/),m=l.match(/\?pwd=([a-zA-Z0-9_-]+)/),n=l.match(/&pwd=([a-zA-Z0-9_-]+)/),u=l.match(/提取码:\s?([a-zA-Z0-9_-]+)/);let c;if(o)c=o[1];else if(e)c=e[1];else return!1;const y=m?m[1]:n?n[1]:u?u[1]:null;return o?{surl:!0,id:c,pwd:y}:{id:c,pwd:y}},C={url:[{required:!0,validator:E,trigger:"blur"}]},z=async l=>{if(!l||!await l.validate())return;const e=new URLSearchParams;e.set("url",r.value.url),e.set("surl",r.value.surl),e.set("pwd",r.value.pwd),e.set("dir",r.value.dir),Y(`${location.host}/?${e.toString()}`,"复制成功")};N(()=>{Z(()=>{const l=new URLSearchParams(location.search);l.size<4||(r.value={url:l.get("url")??"",pwd:l.get("pwd")??"",dir:l.get("dir")??"/",surl:l.get("surl")??""},$.success("已读取到参数,正在加载"),setTimeout(f.getFileList,1e3))}),f.getLimit()});const B=D(),R=()=>B.push("/login");return(l,e)=>{const o=P,m=q,n=J,u=K,c=j,y=H,U=O;return I((d(),p(y,null,{default:i(()=>[T("h2",null,"前台解析中心 | "+G(t(X)()),1),t(w).have_account?(d(),p(o,{key:0,title:"当前中转账号充足",type:"success"})):(d(),p(o,{key:1,title:"当前中转账号不足",type:"error"})),t(w).debug?(d(),p(o,{key:2,class:"alert",title:"当前网站开启了DEBUG模式,非调试请关闭!!!!",type:"error"})):_("",!0),t(w).is_https?_("",!0):(d(),p(o,{key:3,class:"alert",title:"当前网站未开启SSL,可能出现无法请求Aria2服务器的问题",type:"error"})),a(o,{class:"alert",type:t(k)?"error":"success",title:t(k)?"当前用户配额已用完":`当前用户组: ${t(v).group_name} 当前剩余解析次数: ${t(v).count} 当前剩余解析大小: ${t(ee)(t(v).size)}`},null,8,["type","title"]),a(c,{ref_key:"getFileListFormRef",ref:L,model:t(r),rules:C,"label-width":"auto",class:"form"},{default:i(()=>[a(n,{label:"链接",prop:"url"},{default:i(()=>[a(m,{modelValue:t(r).url,"onUpdate:modelValue":e[0]||(e[0]=s=>t(r).url=s),modelModifiers:{trim:!0},onBlur:e[1]||(e[1]=s=>A())},null,8,["modelValue"])]),_:1}),a(n,{label:"密码",prop:"pwd"},{default:i(()=>[a(m,{modelValue:t(r).pwd,"onUpdate:modelValue":e[2]||(e[2]=s=>t(r).pwd=s),modelModifiers:{trim:!0}},null,8,["modelValue"])]),_:1}),t(w).need_password?(d(),p(n,{key:0,label:"解析密码",prop:"password"},{default:i(()=>[a(m,{modelValue:t(r).password,"onUpdate:modelValue":e[3]||(e[3]=s=>t(r).password=s),modelModifiers:{trim:!0}},null,8,["modelValue"])]),_:1})):_("",!0),a(n,{label:"当前路径",prop:"dir"},{default:i(()=>[a(m,{modelValue:t(r).dir,"onUpdate:modelValue":e[4]||(e[4]=s=>t(r).dir=s),disabled:""},null,8,["modelValue"])]),_:1}),a(n,{label:" "},{default:i(()=>[a(u,{type:"primary",onClick:e[5]||(e[5]=s=>t(f).getFileList())},{default:i(()=>[g("获取/刷新列表")]),_:1}),a(u,{type:"primary",disabled:t(h).length<=0,onClick:e[6]||(e[6]=s=>t(f).getDownloadLinks())},{default:i(()=>[g(" 批量解析 ")]),_:1},8,["disabled"]),a(u,{type:"primary",onClick:e[7]||(e[7]=s=>z(t(L)))},{default:i(()=>[g("复制当前地址")]),_:1}),t(M)()==="0"?(d(),p(u,{key:0,type:"primary",onClick:e[8]||(e[8]=s=>R())},{default:i(()=>[g("登陆")]),_:1})):_("",!0),t(M)()==="1"?(d(),p(u,{key:1,type:"danger",onClick:e[9]||(e[9]=s=>t(V).logout())},{default:i(()=>[g("注销")]),_:1})):_("",!0)]),_:1})]),_:1},8,["model"])]),_:1})),[[U,t(S)]])}}}),de=te(le,[["__scopeId","data-v-67f595d5"]]);export{de as default};
