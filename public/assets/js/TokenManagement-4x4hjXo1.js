import{i as g}from"./index-BrFEbl1v.js";import{c as h}from"./copy-DyHnEpWH.js";import{f as S}from"./format-DaCfCw6f.js";import{_ as $}from"./_plugin-vue_export-helper-DlAUqK2U.js";/* empty css              */const M=d=>g.post("/admin/token",d),F=d=>g.post("/admin/token/generate",d),P=d=>g.get(`/admin/token?page=${d.page}&size=${d.size}`),j=d=>g.patch(`/admin/token/${d.id}`,d),q=d=>g.delete("/admin/token",{data:{token_ids:[d.id]}}),L=d=>g.delete("/admin/token",{data:{token_ids:d}}),A=Vue.defineComponent({__name:"AddToken",props:{modelValue:{},modelModifiers:{}},emits:Vue.mergeModels(["getTokens"],["update:modelValue"]),setup(d,{emit:r}){const _=r,m=Vue.useModel(d,"modelValue"),c=Vue.ref(!1),t=Vue.ref({type:"single",name:"",count:1,size:1,day:1}),s=Vue.ref(null),C={name:[{required:!0,message:"请输入卡密名称",trigger:"blur"}],token_count:[{required:!0,message:"请输入卡密个数",trigger:"blur"}],day:[{required:!0,message:"请输入卡密天数",trigger:"blur"}],count:[{required:!0,message:"请输入可下载次数",trigger:"blur"}],size:[{required:!0,message:"请输入可下载大小",trigger:"blur"}]},N=async v=>{if(!(!v||!await v.validate()))try{c.value=!0,t.value.type==="single"?await M({type:"single",name:t.value.name,count:t.value.count,size:t.value.size,day:t.value.day}):await F({type:"random",token_count:t.value.token_count,count:t.value.count,size:t.value.size,day:t.value.day}),ElementPlus.ElMessage.success("添加成功")}finally{c.value=!1}},x=v=>{_("getTokens"),v()},b=()=>{m.value=!1,_("getTokens")};return(v,u)=>{const f=Vue.resolveComponent("el-option"),w=Vue.resolveComponent("el-select"),p=Vue.resolveComponent("el-form-item"),l=Vue.resolveComponent("el-input-number"),a=Vue.resolveComponent("el-input"),n=Vue.resolveComponent("el-form"),i=Vue.resolveComponent("el-button"),k=Vue.resolveComponent("el-dialog"),y=Vue.resolveDirective("loading");return Vue.openBlock(),Vue.createBlock(k,{title:"添加卡密",width:"60%",modelValue:m.value,"onUpdate:modelValue":u[8]||(u[8]=o=>m.value=o),"before-close":x},{footer:Vue.withCtx(()=>[Vue.createVNode(i,{type:"info",onClick:u[6]||(u[6]=o=>b())},{default:Vue.withCtx(()=>[Vue.createTextVNode("取消")]),_:1}),Vue.createVNode(i,{type:"primary",onClick:u[7]||(u[7]=o=>N(s.value))},{default:Vue.withCtx(()=>[Vue.createTextVNode("添加")]),_:1})]),default:Vue.withCtx(()=>[Vue.withDirectives((Vue.openBlock(),Vue.createBlock(n,{ref_key:"addTokenFormRef",ref:s,model:t.value,rules:C,"label-width":"auto"},{default:Vue.withCtx(()=>[Vue.createVNode(p,{label:"创建方式",prop:"type"},{default:Vue.withCtx(()=>[Vue.createVNode(w,{modelValue:t.value.type,"onUpdate:modelValue":u[0]||(u[0]=o=>t.value.type=o)},{default:Vue.withCtx(()=>[(Vue.openBlock(),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList(["single","random"],o=>Vue.createVNode(f,{key:o,label:o,value:o},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),Vue.createVNode(p,{label:"可用次数",prop:"count"},{default:Vue.withCtx(()=>[Vue.createVNode(l,{modelValue:t.value.count,"onUpdate:modelValue":u[1]||(u[1]=o=>t.value.count=o)},null,8,["modelValue"])]),_:1}),Vue.createVNode(p,{label:"可用天数",prop:"day"},{default:Vue.withCtx(()=>[Vue.createVNode(l,{modelValue:t.value.day,"onUpdate:modelValue":u[2]||(u[2]=o=>t.value.day=o)},null,8,["modelValue"])]),_:1}),Vue.createVNode(p,{label:"可用大小(GB)",prop:"size"},{default:Vue.withCtx(()=>[Vue.createVNode(l,{modelValue:t.value.size,"onUpdate:modelValue":u[3]||(u[3]=o=>t.value.size=o)},null,8,["modelValue"])]),_:1}),t.value.type==="single"?(Vue.openBlock(),Vue.createBlock(p,{key:0,label:"卡密名称",prop:"name"},{default:Vue.withCtx(()=>[Vue.createVNode(a,{modelValue:t.value.name,"onUpdate:modelValue":u[4]||(u[4]=o=>t.value.name=o)},null,8,["modelValue"])]),_:1})):(Vue.openBlock(),Vue.createBlock(p,{key:1,label:"卡密个数",prop:"token_count"},{default:Vue.withCtx(()=>[Vue.createVNode(l,{modelValue:t.value.token_count,"onUpdate:modelValue":u[5]||(u[5]=o=>t.value.token_count=o)},null,8,["modelValue"])]),_:1}))]),_:1},8,["model"])),[[y,c.value]])]),_:1},8,["modelValue"])}}}),R=Vue.defineComponent({__name:"TokenManagement",setup(d){const r=Vue.ref(!1),_=Vue.ref(15),m=Vue.ref(1),c=Vue.ref(),t=Vue.ref([]),s=async()=>{try{r.value=!0;const l=await P({page:m.value,size:_.value});c.value=l.data}finally{r.value=!1}},C=async l=>{l.edit=!(l.edit??!1)},N=async l=>{l.edit=!(l.edit??!0),await x(l)},x=async l=>{try{r.value=!0,await j(l),ElementPlus.ElMessage.success("修改卡密成功")}finally{r.value=!1,await s()}},b=async l=>{try{r.value=!0,await q(l),ElementPlus.ElMessage.success("删除卡密成功")}finally{r.value=!1,await s()}},v=async()=>{try{r.value=!0;const l=t.value.map(a=>a.id);await L(l),ElementPlus.ElMessage.success("删除卡密成功")}finally{r.value=!1,await s()}},u=l=>t.value=l;Vue.onMounted(s);const f=Vue.ref(!1),w=()=>f.value=!f.value,p=(l=!0)=>{if(!l){h(t.value.map(n=>n.name).join(`
`));return}const a=t.value.map(n=>[n.name,n.count,n.size,n.day].join(" | "));a.unshift(["卡密","可用次数","可下载量","可用天数"].join(" | ")),h(a.join(`
`))};return(l,a)=>{var T,z,D;const n=Vue.resolveComponent("el-button"),i=Vue.resolveComponent("el-table-column"),k=Vue.resolveComponent("el-input"),y=Vue.resolveComponent("el-input-number"),o=Vue.resolveComponent("el-date-picker"),B=Vue.resolveComponent("el-table"),U=Vue.resolveComponent("el-pagination"),E=Vue.resolveDirective("loading");return Vue.openBlock(),Vue.createElementBlock(Vue.Fragment,null,[Vue.createVNode(A,{onGetTokens:s,modelValue:f.value,"onUpdate:modelValue":a[0]||(a[0]=e=>f.value=e)},null,8,["modelValue"]),Vue.createVNode(n,{type:"primary",onClick:a[1]||(a[1]=e=>s())},{default:Vue.withCtx(()=>[Vue.createTextVNode("刷新列表")]),_:1}),Vue.createVNode(n,{type:"primary",onClick:a[2]||(a[2]=e=>w())},{default:Vue.withCtx(()=>[Vue.createTextVNode("添加卡密")]),_:1}),Vue.createVNode(n,{type:"primary",disabled:t.value.length<=0,onClick:a[3]||(a[3]=e=>p())},{default:Vue.withCtx(()=>[Vue.createTextVNode(" 批量复制 ")]),_:1},8,["disabled"]),Vue.createVNode(n,{type:"primary",disabled:t.value.length<=0,onClick:a[4]||(a[4]=e=>p(!1))},{default:Vue.withCtx(()=>[Vue.createTextVNode(" 批量复制(无格式) ")]),_:1},8,["disabled"]),Vue.createVNode(n,{type:"danger",disabled:t.value.length<=0,onClick:a[5]||(a[5]=e=>v())},{default:Vue.withCtx(()=>[Vue.createTextVNode(" 批量删除 ")]),_:1},8,["disabled"]),Vue.withDirectives((Vue.openBlock(),Vue.createBlock(B,{data:((T=c.value)==null?void 0:T.data)??[],border:"","show-overflow-tooltip":"",class:"table",onSelectionChange:u},{default:Vue.withCtx(()=>[Vue.createVNode(i,{type:"selection",width:"40"}),Vue.createVNode(i,{prop:"id",label:"ID"}),Vue.createVNode(i,{prop:"name",label:"卡密名称"},{default:Vue.withCtx(({row:e})=>[Vue.withDirectives(Vue.createElementVNode("span",null,Vue.toDisplayString(e.name),513),[[Vue.vShow,!e.edit]]),Vue.withDirectives(Vue.createVNode(k,{modelValue:e.name,"onUpdate:modelValue":V=>e.name=V},null,8,["modelValue","onUpdate:modelValue"]),[[Vue.vShow,e.edit]])]),_:1}),Vue.createVNode(i,{prop:"today_size",label:"今日解析"},{default:Vue.withCtx(({row:e})=>[Vue.createElementVNode("span",null,Vue.toDisplayString(e.today_count)+" ("+Vue.toDisplayString(Vue.unref(S)(e.today_size??0))+")",1)]),_:1}),Vue.createVNode(i,{prop:"today_size",label:"縂共解析"},{default:Vue.withCtx(({row:e})=>[Vue.createElementVNode("span",null,Vue.toDisplayString(e.total_count)+" ("+Vue.toDisplayString(Vue.unref(S)(e.total_size??0))+")",1)]),_:1}),Vue.createVNode(i,{prop:"count",label:"可用次数"},{default:Vue.withCtx(({row:e})=>[Vue.withDirectives(Vue.createElementVNode("span",null,Vue.toDisplayString(e.count),513),[[Vue.vShow,!e.edit]]),Vue.withDirectives(Vue.createVNode(y,{modelValue:e.count,"onUpdate:modelValue":V=>e.count=V},null,8,["modelValue","onUpdate:modelValue"]),[[Vue.vShow,e.edit]])]),_:1}),Vue.createVNode(i,{prop:"size",label:"可下载大小"},{default:Vue.withCtx(({row:e})=>[Vue.withDirectives(Vue.createElementVNode("span",null,Vue.toDisplayString(e.size),513),[[Vue.vShow,!e.edit]]),Vue.withDirectives(Vue.createVNode(y,{modelValue:e.size,"onUpdate:modelValue":V=>e.size=V},null,8,["modelValue","onUpdate:modelValue"]),[[Vue.vShow,e.edit]])]),_:1}),Vue.createVNode(i,{prop:"day",label:"有效期"},{default:Vue.withCtx(({row:e})=>[Vue.withDirectives(Vue.createElementVNode("span",null,Vue.toDisplayString(e.day),513),[[Vue.vShow,!e.edit]]),Vue.withDirectives(Vue.createVNode(y,{modelValue:e.day,"onUpdate:modelValue":V=>e.day=V},null,8,["modelValue","onUpdate:modelValue"]),[[Vue.vShow,e.edit]])]),_:1}),Vue.createVNode(i,{prop:"expired_at",label:"到期时间",width:"250"},{default:Vue.withCtx(({row:e})=>[Vue.withDirectives(Vue.createElementVNode("span",null,Vue.toDisplayString(e.expired_at?`${new Date(e.expired_at).getTime()<Date.now()?"(已过期) ":""}${new Date(e.expired_at).toLocaleString()}`:"未使用"),513),[[Vue.vShow,!e.edit]]),e.edit?(Vue.openBlock(),Vue.createBlock(o,{key:0,modelValue:e.expired_at,"onUpdate:modelValue":V=>e.expired_at=V,type:"datetime",placeholder:"请选择日期"},null,8,["modelValue","onUpdate:modelValue"])):Vue.createCommentVNode("",!0)]),_:1}),Vue.createVNode(i,{prop:"ip",label:"ip"},{default:Vue.withCtx(({row:e})=>[Vue.withDirectives(Vue.createElementVNode("span",null,Vue.toDisplayString(e.ip??"未绑定ip"),513),[[Vue.vShow,!e.edit]]),Vue.withDirectives(Vue.createVNode(k,{modelValue:e.ip,"onUpdate:modelValue":V=>e.ip=V},null,8,["modelValue","onUpdate:modelValue"]),[[Vue.vShow,e.edit]])]),_:1}),Vue.createVNode(i,{prop:"created_at",label:"创建时间"},{default:Vue.withCtx(({row:e})=>[Vue.createTextVNode(Vue.toDisplayString(new Date(e.created_at).toLocaleString()),1)]),_:1}),Vue.createVNode(i,{prop:"updated_at",label:"更新时间"},{default:Vue.withCtx(({row:e})=>[Vue.createTextVNode(Vue.toDisplayString(new Date(e.updated_at).toLocaleString()),1)]),_:1}),Vue.createVNode(i,{width:"200",label:"操作",fixed:"right"},{default:Vue.withCtx(({row:e})=>[e.edit?Vue.createCommentVNode("",!0):(Vue.openBlock(),Vue.createBlock(n,{key:0,size:"small",type:"primary",onClick:V=>C(e)},{default:Vue.withCtx(()=>[Vue.createTextVNode(" 编辑 ")]),_:2},1032,["onClick"])),e.edit?(Vue.openBlock(),Vue.createBlock(n,{key:1,size:"small",type:"primary",onClick:V=>N(e)},{default:Vue.withCtx(()=>[Vue.createTextVNode(" 保存 ")]),_:2},1032,["onClick"])):Vue.createCommentVNode("",!0),Vue.createVNode(n,{size:"small",type:"primary",onClick:V=>Vue.unref(h)(e.name)},{default:Vue.withCtx(()=>[Vue.createTextVNode("复制")]),_:2},1032,["onClick"]),Vue.createVNode(n,{size:"small",type:"danger",onClick:V=>b(e)},{default:Vue.withCtx(()=>[Vue.createTextVNode("删除")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[E,r.value]]),Vue.createVNode(U,{"current-page":m.value,"onUpdate:currentPage":a[6]||(a[6]=e=>m.value=e),"page-size":_.value,"onUpdate:pageSize":a[7]||(a[7]=e=>_.value=e),"page-sizes":[15,50,100,500,((z=c.value)==null?void 0:z.total)??100],total:((D=c.value)==null?void 0:D.total)??100,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:s,onCurrentChange:s},null,8,["current-page","page-size","page-sizes","total"])],64)}}}),K=$(R,[["__scopeId","data-v-9f80afaa"]]);export{K as default};
