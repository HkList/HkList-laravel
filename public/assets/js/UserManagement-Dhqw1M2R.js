import{i as g}from"./index-BjgW1GUm.js";import{f as D}from"./format-DaCfCw6f.js";import{_ as B}from"./_plugin-vue_export-helper-DlAUqK2U.js";/* empty css              */const $=n=>g.post("/admin/user",n),M=n=>g.get(`/admin/user?page=${n.page}&size=${n.size}`),T=n=>g.patch(`/admin/user/${n.id}`,n),F=n=>g.delete("/admin/user",{data:{user_ids:[n.id]}}),P=n=>g.delete("/admin/user",{data:{user_ids:n}}),L=Vue.defineComponent({__name:"AddUser",props:{modelValue:{},modelModifiers:{}},emits:Vue.mergeModels(["getUsers"],["update:modelValue"]),setup(n,{emit:d}){const _=d,m=Vue.useModel(n,"modelValue"),i=Vue.ref(!1),r=Vue.ref({username:"",password:"",role:"user",inv_code_id:1}),V=Vue.ref(null),y={username:[{required:!0,message:"请输入账户用户名",trigger:"blur"}],password:[{required:!0,message:"请输入账户密码",trigger:"blur"}]},N=async v=>{if(!(!v||!await v.validate()))try{i.value=!0,await $(r.value),ElementPlus.ElMessage.success("添加成功")}finally{i.value=!1}},w=v=>{_("getUsers"),v()},x=()=>{m.value=!1,_("getUsers")};return(v,a)=>{const p=Vue.resolveComponent("el-input"),f=Vue.resolveComponent("el-form-item"),t=Vue.resolveComponent("el-option"),o=Vue.resolveComponent("el-select"),c=Vue.resolveComponent("el-form"),u=Vue.resolveComponent("el-button"),C=Vue.resolveComponent("el-dialog"),U=Vue.resolveDirective("loading");return Vue.openBlock(),Vue.createBlock(C,{title:"添加用户",width:"60%",modelValue:m.value,"onUpdate:modelValue":a[6]||(a[6]=l=>m.value=l),"before-close":w},{footer:Vue.withCtx(()=>[Vue.createVNode(u,{type:"info",onClick:a[4]||(a[4]=l=>x())},{default:Vue.withCtx(()=>[Vue.createTextVNode("取消")]),_:1}),Vue.createVNode(u,{type:"primary",onClick:a[5]||(a[5]=l=>N(V.value))},{default:Vue.withCtx(()=>[Vue.createTextVNode("添加")]),_:1})]),default:Vue.withCtx(()=>[Vue.withDirectives((Vue.openBlock(),Vue.createBlock(c,{ref_key:"addUserFormRef",ref:V,model:r.value,rules:y,"label-width":"auto"},{default:Vue.withCtx(()=>[Vue.createVNode(f,{label:"用户名",prop:"username"},{default:Vue.withCtx(()=>[Vue.createVNode(p,{modelValue:r.value.username,"onUpdate:modelValue":a[0]||(a[0]=l=>r.value.username=l)},null,8,["modelValue"])]),_:1}),Vue.createVNode(f,{label:"密码",prop:"password"},{default:Vue.withCtx(()=>[Vue.createVNode(p,{modelValue:r.value.password,"onUpdate:modelValue":a[1]||(a[1]=l=>r.value.password=l)},null,8,["modelValue"])]),_:1}),Vue.createVNode(f,{label:"权限",prop:"role"},{default:Vue.withCtx(()=>[Vue.createVNode(o,{modelValue:r.value.role,"onUpdate:modelValue":a[2]||(a[2]=l=>r.value.role=l)},{default:Vue.withCtx(()=>[(Vue.openBlock(),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList(["user","admin"],l=>Vue.createVNode(t,{key:l,label:l,value:l},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),Vue.createVNode(f,{label:"邀请码ID",prop:"inv_code_id"},{default:Vue.withCtx(()=>[Vue.createVNode(p,{modelValue:r.value.inv_code_id,"onUpdate:modelValue":a[3]||(a[3]=l=>r.value.inv_code_id=l)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])),[[U,i.value]])]),_:1},8,["modelValue"])}}}),A=Vue.defineComponent({__name:"UserManagement",setup(n){const d=Vue.ref(!1),_=Vue.ref(15),m=Vue.ref(1),i=Vue.ref(),r=Vue.ref([]),V=async()=>{try{d.value=!0;const t=await M({page:m.value,size:_.value});i.value=t.data}finally{d.value=!1}},y=async t=>{t.edit=!(t.edit??!1)},N=async t=>{t.edit=!(t.edit??!0),await w(t)},w=async t=>{try{d.value=!0,await T(t),ElementPlus.ElMessage.success("修改用户成功")}finally{d.value=!1,await V()}},x=async t=>{try{d.value=!0,await F(t),ElementPlus.ElMessage.success("删除用户成功")}finally{d.value=!1,await V()}},v=async()=>{try{d.value=!0;const t=r.value.map(o=>o.id);await P(t),ElementPlus.ElMessage.success("批量删除用户成功")}finally{d.value=!1,await V()}},a=t=>r.value=t;Vue.onMounted(V);const p=Vue.ref(!1),f=()=>p.value=!p.value;return(t,o)=>{var b,k,h;const c=Vue.resolveComponent("el-button"),u=Vue.resolveComponent("el-table-column"),C=Vue.resolveComponent("el-input"),U=Vue.resolveComponent("el-option"),l=Vue.resolveComponent("el-select"),S=Vue.resolveComponent("el-table"),E=Vue.resolveComponent("el-pagination"),z=Vue.resolveDirective("loading");return Vue.openBlock(),Vue.createElementBlock(Vue.Fragment,null,[Vue.createVNode(L,{onGetUsers:V,modelValue:p.value,"onUpdate:modelValue":o[0]||(o[0]=e=>p.value=e)},null,8,["modelValue"]),Vue.createVNode(c,{type:"primary",onClick:o[1]||(o[1]=e=>V())},{default:Vue.withCtx(()=>[Vue.createTextVNode("刷新列表")]),_:1}),Vue.createVNode(c,{type:"primary",onClick:o[2]||(o[2]=e=>f())},{default:Vue.withCtx(()=>[Vue.createTextVNode("添加用户")]),_:1}),Vue.createVNode(c,{type:"danger",disabled:r.value.length<=0,onClick:o[3]||(o[3]=e=>v())},{default:Vue.withCtx(()=>[Vue.createTextVNode(" 批量删除 ")]),_:1},8,["disabled"]),Vue.withDirectives((Vue.openBlock(),Vue.createBlock(S,{data:((b=i.value)==null?void 0:b.data)??[],border:"","show-overflow-tooltip":"",class:"table",onSelectionChange:a},{default:Vue.withCtx(()=>[Vue.createVNode(u,{type:"selection",width:"40"}),Vue.createVNode(u,{prop:"id",label:"ID"}),Vue.createVNode(u,{prop:"",label:"用户组"},{default:Vue.withCtx(({row:e})=>[Vue.createElementVNode("span",null,Vue.toDisplayString(e.group.id)+" ("+Vue.toDisplayString(e.group.name)+")",1)]),_:1}),Vue.createVNode(u,{prop:"inv_code.name",label:"邀请码"},{default:Vue.withCtx(({row:e})=>[Vue.createElementVNode("span",null,Vue.toDisplayString(e.inv_code.id)+" ("+Vue.toDisplayString(e.inv_code.name)+")",1)]),_:1}),Vue.createVNode(u,{prop:"today_size",label:"今日解析"},{default:Vue.withCtx(({row:e})=>[Vue.createElementVNode("span",null,Vue.toDisplayString(e.today_count)+" ("+Vue.toDisplayString(Vue.unref(D)(e.today_size??0))+")",1)]),_:1}),Vue.createVNode(u,{prop:"today_size",label:"縂共解析"},{default:Vue.withCtx(({row:e})=>[Vue.createElementVNode("span",null,Vue.toDisplayString(e.total_count)+" ("+Vue.toDisplayString(Vue.unref(D)(e.total_size??0))+")",1)]),_:1}),Vue.createVNode(u,{prop:"username",label:"用户名"},{default:Vue.withCtx(({row:e})=>[Vue.withDirectives(Vue.createElementVNode("span",null,Vue.toDisplayString(e.username),513),[[Vue.vShow,!e.edit]]),Vue.withDirectives(Vue.createVNode(C,{modelValue:e.username,"onUpdate:modelValue":s=>e.username=s},null,8,["modelValue","onUpdate:modelValue"]),[[Vue.vShow,e.edit]])]),_:1}),Vue.createVNode(u,{prop:"password",label:"密码"},{default:Vue.withCtx(({row:e})=>[Vue.withDirectives(Vue.createElementVNode("span",null,Vue.toDisplayString(e.password),513),[[Vue.vShow,!e.edit]]),Vue.withDirectives(Vue.createVNode(C,{modelValue:e.password,"onUpdate:modelValue":s=>e.password=s},null,8,["modelValue","onUpdate:modelValue"]),[[Vue.vShow,e.edit]])]),_:1}),Vue.createVNode(u,{prop:"role",label:"权限"},{default:Vue.withCtx(({row:e})=>[Vue.withDirectives(Vue.createElementVNode("span",null,Vue.toDisplayString(e.role),513),[[Vue.vShow,!e.edit]]),Vue.withDirectives(Vue.createVNode(l,{modelValue:e.role,"onUpdate:modelValue":s=>e.role=s},{default:Vue.withCtx(()=>[(Vue.openBlock(),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList(["user","admin"],s=>Vue.createVNode(U,{key:s,label:s,value:s},null,8,["label","value"])),64))]),_:2},1032,["modelValue","onUpdate:modelValue"]),[[Vue.vShow,e.edit]])]),_:1}),Vue.createVNode(u,{prop:"created_at",label:"创建时间"},{default:Vue.withCtx(({row:e})=>[Vue.createTextVNode(Vue.toDisplayString(new Date(e.created_at).toLocaleString()),1)]),_:1}),Vue.createVNode(u,{prop:"updated_at",label:"更新时间"},{default:Vue.withCtx(({row:e})=>[Vue.createTextVNode(Vue.toDisplayString(new Date(e.updated_at).toLocaleString()),1)]),_:1}),Vue.createVNode(u,{width:"150",label:"操作",fixed:"right"},{default:Vue.withCtx(({row:e})=>[e.edit?Vue.createCommentVNode("",!0):(Vue.openBlock(),Vue.createBlock(c,{key:0,size:"small",type:"primary",onClick:s=>y(e)},{default:Vue.withCtx(()=>[Vue.createTextVNode(" 编辑 ")]),_:2},1032,["onClick"])),e.edit?(Vue.openBlock(),Vue.createBlock(c,{key:1,size:"small",type:"primary",onClick:s=>N(e)},{default:Vue.withCtx(()=>[Vue.createTextVNode(" 保存 ")]),_:2},1032,["onClick"])):Vue.createCommentVNode("",!0),Vue.createVNode(c,{size:"small",type:"danger",onClick:s=>x(e)},{default:Vue.withCtx(()=>[Vue.createTextVNode("删除")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[z,d.value]]),Vue.createVNode(E,{"current-page":m.value,"onUpdate:currentPage":o[4]||(o[4]=e=>m.value=e),"page-size":_.value,"onUpdate:pageSize":o[5]||(o[5]=e=>_.value=e),"page-sizes":[15,50,100,500,((k=i.value)==null?void 0:k.total)??100],total:((h=i.value)==null?void 0:h.total)??100,layout:"sizes, prev, pager, next",onSizeChange:V,onCurrentChange:V},null,8,["current-page","page-size","page-sizes","total"])],64)}}}),G=B(A,[["__scopeId","data-v-39a05d3b"]]);export{G as default};
