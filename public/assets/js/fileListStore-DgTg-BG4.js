import{d as k,e as y,f as F,h as _}from"./index-CdKk1Oin.js";import{d as S,r as s,E as l}from"./.pnpm-Ddnih9Rt.js";const P=S("fileListStore",()=>{const a=s(!1),t=s({surl:"",url:"",pwd:"",dir:"/",password:""}),c=s(null),w=()=>{const e=t.value.dir.split("/");e.pop();const n=e.join("/");return n===""?"/":n},r=s({sign:"",timestamp:0}),p=async()=>{try{a.value=!0;const e=await _({surl:t.value.surl,uk:i.value.uk,shareid:i.value.shareid,password:t.value.password});r.value.sign=e.data.sign,r.value.timestamp=e.data.timestamp,l.success("获取签名成功")}finally{a.value=!1}},d=async()=>{Date.now()/1e3-r.value.timestamp>250?(l.info("获取签名中"),await p()):l.success("签名未过期,无需更新")},L=async()=>{if(!(!c.value||!await c.value.validate())){if(t.value.surl==="")return l.error("获取链接surl失败");try{o.value=[],a.value=!0;const e=await k(t.value);i.value=e.data,t.value.dir!=="/"&&i.value.list.unshift({category:-1,fs_id:0,isdir:1,local_ctime:0,local_mtime:0,server_ctime:0,server_mtime:0,size:0,md5:"",path:w(),server_filename:"..",dlink:""}),l.success("获取文件列表成功")}finally{a.value=!1,await d()}}},i=s({uk:0,shareid:0,randsk:"",list:[]}),o=s([]),m=s([]),h=async e=>{const n=e?[e]:o.value.filter(u=>u.isdir!==1).map(u=>u.fs_id);n.length!==o.value.length&&l.error("文件夹不会被解析!"),await d();try{a.value=!0;const u=await y({uk:i.value.uk,shareid:i.value.shareid,randsk:i.value.randsk,fs_ids:n,sign:r.value.sign,timestamp:r.value.timestamp,password:t.value.password});m.value=u.data,l.success("解析成功")}finally{a.value=!1,await g()}},f=s({group_name:"",count:0,size:0}),v=s(!1),g=async()=>{try{a.value=!0;const e=await F();f.value=e.data,v.value=!1}catch{v.value=!0}finally{a.value=!1}};return{pending:a,fileList:i,getFileList:L,getFileListForm:t,getFileListFormRef:c,selectedRows:o,downloadLinks:m,getDownloadLinks:h,limitForm:f,getLimit:g,hitLimit:v}});export{P as u};
