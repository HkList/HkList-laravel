import{C as re,I as R,U as A,t as fe,d as X}from"./base-_Z90q_OM.js";import{v as ge}from"./el-loading-BLv8TCma.js";import{E as be,a as Ve}from"./el-form-item-C5NMiDU5.js";import{E as ve}from"./el-button--fR7yW34.js";import{E as ae}from"./el-input-4DyiygPx.js";import{E as we}from"./el-switch-1LZhS8JE.js";import{b as Ne,c as Ee,e as _e}from"./admin-BqPTuhYq.js";import{a7 as Z,a as j,r as H,N as he,g as x,G as ye,o as oe,J as Ie,e as I,c as K,P as J,u as n,n as $,af as z,h as ee,b as o,w as f,R as F,i as ne,a6 as W,L as Se,d as Ce,k as Pe,ag as ke,q as xe,B as Ae}from"./index-DIq-y8TX.js";import{b as Fe,y as Ue,n as h,C as U,D as Te,u as Me,l as O,F as Be,G as De,f as te,H as ze,p as Oe,_ as Re,w as qe,E as Y}from"./request-CizaxWX-.js";import{a as Le,u as Ge,b as Ke}from"./use-form-item-DyPqMXJn.js";import"./_initCloneObject-B9VpDC3c.js";const $e=100,We=600,le={beforeMount(i,E){const t=E.value,{interval:a=$e,delay:C=We}=Z(t)?{}:t;let b,v;const d=()=>Z(t)?t():t.handler(),N=()=>{v&&(clearTimeout(v),v=void 0),b&&(clearInterval(b),b=void 0)};i.addEventListener("mousedown",V=>{V.button===0&&(N(),d(),document.addEventListener("mouseup",()=>N(),{once:!0}),v=setTimeout(()=>{b=setInterval(()=>{d()},a)},C))})}},Ye=Fe({id:{type:String,default:void 0},step:{type:Number,default:1},stepStrictly:Boolean,max:{type:Number,default:Number.POSITIVE_INFINITY},min:{type:Number,default:Number.NEGATIVE_INFINITY},modelValue:Number,readonly:Boolean,disabled:Boolean,size:Ue,controls:{type:Boolean,default:!0},controlsPosition:{type:String,default:"",values:["","right"]},valueOnClear:{type:[String,Number,null],validator:i=>i===null||h(i)||["min","max"].includes(i),default:null},name:String,label:String,placeholder:String,precision:{type:Number,validator:i=>i>=0&&i===Number.parseInt(`${i}`,10)},validateEvent:{type:Boolean,default:!0}}),He={[re]:(i,E)=>E!==i,blur:i=>i instanceof FocusEvent,focus:i=>i instanceof FocusEvent,[R]:i=>h(i)||U(i),[A]:i=>h(i)||U(i)},Je=["aria-label","onKeydown"],je=["aria-label","onKeydown"],Qe=j({name:"ElInputNumber"}),Xe=j({...Qe,props:Ye,emits:He,setup(i,{expose:E,emit:t}){const a=i,{t:C}=Te(),b=Me("input-number"),v=H(),d=he({currentValue:a.modelValue,userInput:null}),{formItem:N}=Le(),V=x(()=>h(a.modelValue)&&a.modelValue<=a.min),r=x(()=>h(a.modelValue)&&a.modelValue>=a.max),g=x(()=>{const e=T(a.step);return O(a.precision)?Math.max(T(a.modelValue),e):(e>a.precision,a.precision)}),m=x(()=>a.controls&&a.controlsPosition==="right"),S=Ge(),y=Ke(),P=x(()=>{if(d.userInput!==null)return d.userInput;let e=d.currentValue;if(U(e))return"";if(h(e)){if(Number.isNaN(e))return"";O(a.precision)||(e=e.toFixed(a.precision))}return e}),k=(e,l)=>{if(O(l)&&(l=g.value),l===0)return Math.round(e);let s=String(e);const c=s.indexOf(".");if(c===-1||!s.replace(".","").split("")[c+l])return e;const B=s.length;return s.charAt(B-1)==="5"&&(s=`${s.slice(0,Math.max(0,B-1))}6`),Number.parseFloat(Number(s).toFixed(l))},T=e=>{if(U(e))return 0;const l=e.toString(),s=l.indexOf(".");let c=0;return s!==-1&&(c=l.length-s-1),c},u=(e,l=1)=>h(e)?k(e+a.step*l):d.currentValue,q=()=>{if(a.readonly||y.value||r.value)return;const e=Number(P.value)||0,l=u(e);M(l),t(R,d.currentValue),G()},L=()=>{if(a.readonly||y.value||V.value)return;const e=Number(P.value)||0,l=u(e,-1);M(l),t(R,d.currentValue),G()},Q=(e,l)=>{const{max:s,min:c,step:p,precision:_,stepStrictly:B,valueOnClear:D}=a;s<c&&fe("InputNumber","min should not be greater than max.");let w=Number(e);if(U(e)||Number.isNaN(w))return null;if(e===""){if(D===null)return null;w=Se(D)?{min:c,max:s}[D]:D}return B&&(w=k(Math.round(w/p)*p,_)),O(_)||(w=k(w,_)),(w>s||w<c)&&(w=w>s?s:c,l&&t(A,w)),w},M=(e,l=!0)=>{var s;const c=d.currentValue,p=Q(e);if(!l){t(A,p);return}c===p&&e||(d.userInput=null,t(A,p),c!==p&&t(re,p,c),a.validateEvent&&((s=N==null?void 0:N.validate)==null||s.call(N,"change").catch(_=>X())),d.currentValue=p)},ue=e=>{d.userInput=e;const l=e===""?null:Number(e);t(R,l),M(l,!1)},se=e=>{const l=e!==""?Number(e):"";(h(l)&&!Number.isNaN(l)||e==="")&&M(l),G(),d.userInput=null},ie=()=>{var e,l;(l=(e=v.value)==null?void 0:e.focus)==null||l.call(e)},de=()=>{var e,l;(l=(e=v.value)==null?void 0:e.blur)==null||l.call(e)},me=e=>{t("focus",e)},ce=e=>{var l;d.userInput=null,t("blur",e),a.validateEvent&&((l=N==null?void 0:N.validate)==null||l.call(N,"blur").catch(s=>X()))},G=()=>{d.currentValue!==a.modelValue&&(d.currentValue=a.modelValue)},pe=e=>{document.activeElement===e.target&&e.preventDefault()};return ye(()=>a.modelValue,(e,l)=>{const s=Q(e,!0);d.userInput===null&&s!==l&&(d.currentValue=s)},{immediate:!0}),oe(()=>{var e;const{min:l,max:s,modelValue:c}=a,p=(e=v.value)==null?void 0:e.input;if(p.setAttribute("role","spinbutton"),Number.isFinite(s)?p.setAttribute("aria-valuemax",String(s)):p.removeAttribute("aria-valuemax"),Number.isFinite(l)?p.setAttribute("aria-valuemin",String(l)):p.removeAttribute("aria-valuemin"),p.setAttribute("aria-valuenow",d.currentValue||d.currentValue===0?String(d.currentValue):""),p.setAttribute("aria-disabled",String(y.value)),!h(c)&&c!=null){let _=Number(c);Number.isNaN(_)&&(_=null),t(A,_)}}),Ie(()=>{var e,l;const s=(e=v.value)==null?void 0:e.input;s==null||s.setAttribute("aria-valuenow",`${(l=d.currentValue)!=null?l:""}`)}),E({focus:ie,blur:de}),(e,l)=>(I(),K("div",{class:$([n(b).b(),n(b).m(n(S)),n(b).is("disabled",n(y)),n(b).is("without-controls",!e.controls),n(b).is("controls-right",n(m))]),onDragstart:l[0]||(l[0]=W(()=>{},["prevent"]))},[e.controls?J((I(),K("span",{key:0,role:"button","aria-label":n(C)("el.inputNumber.decrease"),class:$([n(b).e("decrease"),n(b).is("disabled",n(V))]),onKeydown:z(L,["enter"])},[ee(e.$slots,"decrease-icon",{},()=>[o(n(te),null,{default:f(()=>[n(m)?(I(),F(n(Be),{key:0})):(I(),F(n(De),{key:1}))]),_:1})])],42,Je)),[[n(le),L]]):ne("v-if",!0),e.controls?J((I(),K("span",{key:1,role:"button","aria-label":n(C)("el.inputNumber.increase"),class:$([n(b).e("increase"),n(b).is("disabled",n(r))]),onKeydown:z(q,["enter"])},[ee(e.$slots,"increase-icon",{},()=>[o(n(te),null,{default:f(()=>[n(m)?(I(),F(n(ze),{key:0})):(I(),F(n(Oe),{key:1}))]),_:1})])],42,je)),[[n(le),q]]):ne("v-if",!0),o(n(ae),{id:e.id,ref_key:"input",ref:v,type:"number",step:e.step,"model-value":n(P),placeholder:e.placeholder,readonly:e.readonly,disabled:n(y),size:n(S),max:e.max,min:e.min,name:e.name,label:e.label,"validate-event":!1,onWheel:pe,onKeydown:[z(W(q,["prevent"]),["up"]),z(W(L,["prevent"]),["down"])],onBlur:ce,onFocus:me,onInput:ue,onChange:se},null,8,["id","step","model-value","placeholder","readonly","disabled","size","max","min","name","label","onKeydown"])],34))}});var Ze=Re(Xe,[["__file","input-number.vue"]]);const en=qe(Ze),nn=Ce("ChangeConfig",()=>{const i=H({version:"",frontEndVersion:"",userAgent:"",sleep:1,maxOnce:20,announceSwitch:!1,announce:"",cookie:"",ssl:!1,prefix:"/admin",debug:!1,password:"",passwordSwitch:!1,getPending:!1,changePending:!1}),E=H(null);return{changeConfigForm:i,changeConfigFormRef:E}}),fn=j({__name:"ChangeConfig",setup(i){const E=nn(),{changeConfigForm:t,changeConfigFormRef:a}=Pe(E),v={userAgent:[{required:!0,message:"请输入User_Agent",trigger:"blur"}],announce:[{validator:(V,r,g)=>{t.value.passwordSwitch&&r===""&&g(new Error("请输入公告内容")),g()},trigger:"blur"}],announceSwitch:[{required:!0,message:"请确认开关状态",trigger:"blur"}],debug:[{required:!0,message:"请确认开关状态",trigger:"blur"}],ssl:[{required:!0,message:"请确认开关状态",trigger:"blur"}],prefix:[{required:!0,message:"请输入后台接口后缀",trigger:"blur"}],cookie:[{required:!0,message:"请输入获取列表时的 Cookie",trigger:"blur"}],maxOnce:[{required:!0,message:"请输入批量解析时单次最大解析数量",trigger:"blur"}],sleep:[{required:!0,message:"请输入批量解析时休眠时间(秒)",trigger:"blur"}],password:[{validator:(V,r,g)=>{t.value.passwordSwitch&&r===""&&g(new Error("请输入密码")),g()},trigger:"blur"}],passwordSwitch:[{required:!0,message:"请确认开关状态",trigger:"blur"}]};oe(async()=>await d());const d=async()=>{t.value.getPending=!0;const V=await Ne()??"failed";t.value.getPending=!1,V.toString()!=="failed"&&(t.value={...t.value,...V.data,frontEndVersion:await ke()})},N=async V=>{if(V&&await V.validate(()=>{})){t.value.changePending=!0;const r=await Ee({cookie:t.value.cookie,check:!0})??"failed";if(r.toString()==="failed")return;if(t.value.changePending=!1,r.message!=="cookie校验成功"){Y.error("请不要使用包含账户的cookie,直接退出登陆获取一个新cookie");return}Y.success("cookie校验成功,不包含账户");const g=await _e({...t.value})??"failed";if(t.value.changePending=!1,g.toString()==="failed")return;Y.success("修改成功"),Ae(t.value.prefix),await d()}};return(V,r)=>{const g=ae,m=be,S=we,y=en,P=ve,k=Ve,T=ge;return J((I(),F(k,{ref_key:"changeConfigFormRef",ref:a,model:n(t),rules:v,"label-width":"auto"},{default:f(()=>[o(m,{label:"后端版本号",prop:"version"},{default:f(()=>[o(g,{disabled:"",modelValue:n(t).version,"onUpdate:modelValue":r[0]||(r[0]=u=>n(t).version=u)},null,8,["modelValue"])]),_:1}),o(m,{label:"前端版本号",prop:"frontEndVersion"},{default:f(()=>[o(g,{disabled:"",modelValue:n(t).frontEndVersion,"onUpdate:modelValue":r[1]||(r[1]=u=>n(t).frontEndVersion=u)},null,8,["modelValue"])]),_:1}),o(m,{label:"DEBUG模式开关",prop:"debug"},{default:f(()=>[o(S,{modelValue:n(t).debug,"onUpdate:modelValue":r[2]||(r[2]=u=>n(t).debug=u),size:"large"},null,8,["modelValue"])]),_:1}),o(m,{label:"强制SSL模式开关",prop:"ssl"},{default:f(()=>[o(S,{modelValue:n(t).ssl,"onUpdate:modelValue":r[3]||(r[3]=u=>n(t).ssl=u),size:"large"},null,8,["modelValue"])]),_:1}),o(m,{label:"公告开关",prop:"announceSwitch"},{default:f(()=>[o(S,{modelValue:n(t).announceSwitch,"onUpdate:modelValue":r[4]||(r[4]=u=>n(t).announceSwitch=u),size:"large"},null,8,["modelValue"])]),_:1}),o(m,{label:"公告内容",prop:"announce"},{default:f(()=>[o(g,{type:"textarea",modelValue:n(t).announce,"onUpdate:modelValue":r[5]||(r[5]=u=>n(t).announce=u),modelModifiers:{trim:!0}},null,8,["modelValue"])]),_:1}),o(m,{label:"后台接口前缀",prop:"prefix"},{default:f(()=>[o(g,{modelValue:n(t).prefix,"onUpdate:modelValue":r[6]||(r[6]=u=>n(t).prefix=u),modelModifiers:{trim:!0}},null,8,["modelValue"])]),_:1}),o(m,{label:"下载使用的 User_Agent",prop:"userAgent"},{default:f(()=>[o(g,{modelValue:n(t).userAgent,"onUpdate:modelValue":r[7]||(r[7]=u=>n(t).userAgent=u),modelModifiers:{trim:!0}},null,8,["modelValue"])]),_:1}),o(m,{label:"批量解析时休眠时间(秒)",prop:"sleep"},{default:f(()=>[o(y,{modelValue:n(t).sleep,"onUpdate:modelValue":r[8]||(r[8]=u=>n(t).sleep=u)},null,8,["modelValue"])]),_:1}),o(m,{label:"批量解析时单次最大解析数量",prop:"maxOnce"},{default:f(()=>[o(y,{modelValue:n(t).maxOnce,"onUpdate:modelValue":r[9]||(r[9]=u=>n(t).maxOnce=u)},null,8,["modelValue"])]),_:1}),o(m,{label:"获取列表时的 Cookie",prop:"cookie"},{default:f(()=>[o(g,{type:"textarea",modelValue:n(t).cookie,"onUpdate:modelValue":r[10]||(r[10]=u=>n(t).cookie=u),modelModifiers:{trim:!0},rows:"5"},null,8,["modelValue"])]),_:1}),o(m,{label:"密码开关",prop:"passwordSwitch"},{default:f(()=>[o(S,{modelValue:n(t).passwordSwitch,"onUpdate:modelValue":r[11]||(r[11]=u=>n(t).passwordSwitch=u),size:"large"},null,8,["modelValue"])]),_:1}),o(m,{label:"密码",prop:"password"},{default:f(()=>[o(g,{modelValue:n(t).password,"onUpdate:modelValue":r[12]||(r[12]=u=>n(t).password=u),modelModifiers:{trim:!0}},null,8,["modelValue"])]),_:1}),o(m,{label:" "},{default:f(()=>[o(P,{type:"primary",onClick:r[13]||(r[13]=u=>N(n(a))),loading:n(t).changePending},{default:f(()=>[xe(" 保存 ")]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])),[[T,n(t).getPending]])}}});export{fn as default};
