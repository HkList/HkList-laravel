import{b as Y,$ as ee,a0 as ae,r as m,f as g,c as C,n as l,l as a,x as p,w as b,k as L,F as N,_ as Z,E as A,y as j,z as te,Y as H,Z as J,B as le,A as Q,K as ne,v as W,o as oe,q as G,t as z,a1 as S,C as K,N as se,P as de,a2 as ie}from"./.pnpm-DVFgL_l4.js";import{i as k}from"./index-B89KlgET.js";import{_ as ue}from"./_plugin-vue_export-helper-DlAUqK2U.js";const pe=o=>k.post("/admin/ip",o),re=o=>k.get(`/admin/ip?page=${o.page}&size=${o.size}`),me=o=>k.patch(`/admin/ip/${o.id}`,o),ce=o=>k.delete("/admin/ip",{data:{ip_ids:[o.id]}}),fe=o=>k.delete("/admin/ip",{data:{ip_ids:o}}),_e=/^(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)(\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/,ve=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:))/,X=o=>_e.test(o)||ve.test(o),ge=Y({__name:"AddIp",props:{modelValue:{},modelModifiers:{}},emits:ee(["getIps"],["update:modelValue"]),setup(o,{emit:i}){const V=i,I=ae(o,"modelValue"),c=m(!1),F=(f,n,y)=>{if(!n)return y(new Error("请输入IP地址"));X(n)?y():y(new Error("请输入有效的IP地址"))},d=m({ip:"",mode:0}),$=m(null),U={ip:[{validator:F,message:"请输入IP",trigger:"blur"}]},w=async f=>{if(!(!f||!await f.validate()))try{c.value=!0,await pe(d.value),A.success("添加成功")}finally{c.value=!1}},x=f=>{V("getIps"),f()},M=()=>{I.value=!1,V("getIps")};return(f,n)=>{const y=j,t=te,s=H,_=J,r=le,E=Q,B=ne,D=W;return g(),C(B,{title:"添加IP",width:"60%",modelValue:I.value,"onUpdate:modelValue":n[4]||(n[4]=u=>I.value=u),"before-close":x},{footer:l(()=>[a(E,{type:"info",onClick:n[2]||(n[2]=u=>M())},{default:l(()=>[p("取消")]),_:1}),a(E,{type:"primary",onClick:n[3]||(n[3]=u=>w($.value))},{default:l(()=>[p("添加")]),_:1})]),default:l(()=>[b((g(),C(r,{ref_key:"addIpFormRef",ref:$,model:d.value,rules:U,"label-width":"auto"},{default:l(()=>[a(t,{label:"IP",prop:"ip"},{default:l(()=>[a(y,{modelValue:d.value.ip,"onUpdate:modelValue":n[0]||(n[0]=u=>d.value.ip=u)},null,8,["modelValue"])]),_:1}),a(t,{label:"模式",prop:"mode"},{default:l(()=>[a(_,{modelValue:d.value.mode,"onUpdate:modelValue":n[1]||(n[1]=u=>d.value.mode=u)},{default:l(()=>[(g(),L(N,null,Z(["黑名单","白名单"],(u,P)=>a(s,{key:P,label:u,value:P},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])),[[D,c.value]])]),_:1},8,["modelValue"])}}}),Ie=Y({__name:"IpManagement",setup(o){const i=m(!1),V=m(15),I=m(1),c=m(),F=m([]),d=async()=>{try{i.value=!0;const t=await re({page:I.value,size:V.value});c.value=t.data}finally{i.value=!1}},$=async t=>{t.edit=!(t.edit??!1)},U=async t=>{if(!X(t.ip))return A.error("请输入正确的IP");t.edit=!(t.edit??!0),await w(t)},w=async t=>{try{i.value=!0,await me(t),A.success("修改IP成功")}finally{i.value=!1,await d()}},x=async t=>{try{i.value=!0,await ce(t),A.success("删除IP成功")}finally{i.value=!1,await d()}},M=async()=>{try{i.value=!0;const t=F.value.map(s=>s.id);await fe(t),A.success("批量删除IP成功")}finally{i.value=!1,await d()}},f=t=>F.value=t;oe(d);const n=m(!1),y=()=>n.value=!n.value;return(t,s)=>{var R,O,T;const _=Q,r=se,E=j,B=H,D=J,u=de,P=ie,h=W;return g(),L(N,null,[a(ge,{onGetIps:d,modelValue:n.value,"onUpdate:modelValue":s[0]||(s[0]=e=>n.value=e)},null,8,["modelValue"]),a(_,{type:"primary",onClick:s[1]||(s[1]=e=>d())},{default:l(()=>[p("刷新列表")]),_:1}),a(_,{type:"primary",onClick:s[2]||(s[2]=e=>y())},{default:l(()=>[p("添加IP")]),_:1}),a(_,{type:"danger",disabled:F.value.length<=0,onClick:s[3]||(s[3]=e=>M())},{default:l(()=>[p(" 批量删除 ")]),_:1},8,["disabled"]),b((g(),C(u,{data:((R=c.value)==null?void 0:R.data)??[],border:"","show-overflow-tooltip":"",class:"table",onSelectionChange:f},{default:l(()=>[a(r,{type:"selection",width:"40"}),a(r,{prop:"id",label:"ID"}),a(r,{prop:"ip",label:"IP"},{default:l(({row:e})=>[b(G("span",null,z(e.ip),513),[[S,!e.edit]]),b(a(E,{modelValue:e.ip,"onUpdate:modelValue":v=>e.ip=v},null,8,["modelValue","onUpdate:modelValue"]),[[S,e.edit]])]),_:1}),a(r,{prop:"mode",label:"模式"},{default:l(({row:e})=>[b(G("span",null,z(e.mode?"白名单":"黑名单"),513),[[S,!e.edit]]),b(a(D,{modelValue:e.mode,"onUpdate:modelValue":v=>e.mode=v},{default:l(()=>[(g(),L(N,null,Z(["黑名单","白名单"],(v,q)=>a(B,{key:q,label:v,value:q},null,8,["label","value"])),64))]),_:2},1032,["modelValue","onUpdate:modelValue"]),[[S,e.edit]])]),_:1}),a(r,{prop:"created_at",label:"创建时间"},{default:l(({row:e})=>[p(z(new Date(e.created_at).toLocaleString()),1)]),_:1}),a(r,{prop:"updated_at",label:"更新时间"},{default:l(({row:e})=>[p(z(new Date(e.updated_at).toLocaleString()),1)]),_:1}),a(r,{width:"150",label:"操作",fixed:"right"},{default:l(({row:e})=>[e.edit?K("",!0):(g(),C(_,{key:0,size:"small",type:"primary",onClick:v=>$(e)},{default:l(()=>[p(" 编辑 ")]),_:2},1032,["onClick"])),e.edit?(g(),C(_,{key:1,size:"small",type:"primary",onClick:v=>U(e)},{default:l(()=>[p(" 保存 ")]),_:2},1032,["onClick"])):K("",!0),a(_,{size:"small",type:"danger",onClick:v=>x(e)},{default:l(()=>[p("删除")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[h,i.value]]),a(P,{"current-page":I.value,"onUpdate:currentPage":s[4]||(s[4]=e=>I.value=e),"page-size":V.value,"onUpdate:pageSize":s[5]||(s[5]=e=>V.value=e),"page-sizes":[15,50,100,500,((O=c.value)==null?void 0:O.total)??100],total:((T=c.value)==null?void 0:T.total)??100,layout:"sizes, prev, pager, next",onSizeChange:d,onCurrentChange:d},null,8,["current-page","page-size","page-sizes","total"])],64)}}}),Fe=ue(Ie,[["__scopeId","data-v-3e7199cd"]]);export{Fe as default};
