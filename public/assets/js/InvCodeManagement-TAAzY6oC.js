import{i as g}from"./index-BjgW1GUm.js";import{c as I}from"./copy-DyHnEpWH.js";import{_ as z}from"./_plugin-vue_export-helper-DlAUqK2U.js";/* empty css              */const U=d=>g.post("/admin/inv_code",d),E=d=>g.post("/admin/inv_code/generate",d),T=d=>g.get(`/admin/inv_code?page=${d.page}&size=${d.size}`),M=d=>g.patch(`/admin/inv_code/${d.id}`,d),F=d=>g.delete("/admin/inv_code",{data:{inv_code_ids:[d.id]}}),P=d=>g.delete("/admin/inv_code",{data:{inv_code_ids:d}}),j=Vue.defineComponent({__name:"AddInvCode",props:{modelValue:{},modelModifiers:{}},emits:Vue.mergeModels(["getInvCodes"],["update:modelValue"]),setup(d,{emit:r}){const _=r,m=Vue.useModel(d,"modelValue"),c=Vue.ref(!1),t=Vue.ref({type:"single",group_id:2,name:"",can_count:10}),V=Vue.ref(null),y={group_id:[{required:!0,message:"请输入邀请码用户组ID",trigger:"blur"}],name:[{required:!0,message:"请输入邀请码名称",trigger:"blur"}],can_count:[{required:!0,message:"请输入可注册次数",trigger:"blur"}],count:[{required:!0,message:"请输入邀请码个数",trigger:"blur"}]},N=async v=>{if(!(!v||!await v.validate()))try{c.value=!0,t.value.type==="single"?await U({type:"single",name:t.value.name,can_count:t.value.can_count,group_id:t.value.group_id}):await E({type:"random",count:t.value.count,can_count:t.value.can_count,group_id:t.value.group_id}),ElementPlus.ElMessage.success("添加成功")}finally{c.value=!1}},x=v=>{_("getInvCodes"),v()},b=()=>{m.value=!1,_("getInvCodes")};return(v,u)=>{const C=Vue.resolveComponent("el-option"),w=Vue.resolveComponent("el-select"),p=Vue.resolveComponent("el-form-item"),o=Vue.resolveComponent("el-input-number"),l=Vue.resolveComponent("el-input"),a=Vue.resolveComponent("el-form"),i=Vue.resolveComponent("el-button"),k=Vue.resolveComponent("el-dialog"),f=Vue.resolveDirective("loading");return Vue.openBlock(),Vue.createBlock(k,{title:"添加邀请码",width:"60%",modelValue:m.value,"onUpdate:modelValue":u[7]||(u[7]=n=>m.value=n),"before-close":x},{footer:Vue.withCtx(()=>[Vue.createVNode(i,{type:"info",onClick:u[5]||(u[5]=n=>b())},{default:Vue.withCtx(()=>[Vue.createTextVNode("取消")]),_:1}),Vue.createVNode(i,{type:"primary",onClick:u[6]||(u[6]=n=>N(V.value))},{default:Vue.withCtx(()=>[Vue.createTextVNode("添加")]),_:1})]),default:Vue.withCtx(()=>[Vue.withDirectives((Vue.openBlock(),Vue.createBlock(a,{ref_key:"addInvCodeFormRef",ref:V,model:t.value,rules:y,"label-width":"auto"},{default:Vue.withCtx(()=>[Vue.createVNode(p,{label:"创建方式",prop:"type"},{default:Vue.withCtx(()=>[Vue.createVNode(w,{modelValue:t.value.type,"onUpdate:modelValue":u[0]||(u[0]=n=>t.value.type=n)},{default:Vue.withCtx(()=>[(Vue.openBlock(),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList(["single","random"],n=>Vue.createVNode(C,{key:n,label:n,value:n},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),Vue.createVNode(p,{label:"可用次数",prop:"can_count"},{default:Vue.withCtx(()=>[Vue.createVNode(o,{modelValue:t.value.can_count,"onUpdate:modelValue":u[1]||(u[1]=n=>t.value.can_count=n)},null,8,["modelValue"])]),_:1}),Vue.createVNode(p,{label:"用户组ID",prop:"group_id"},{default:Vue.withCtx(()=>[Vue.createVNode(o,{modelValue:t.value.group_id,"onUpdate:modelValue":u[2]||(u[2]=n=>t.value.group_id=n)},null,8,["modelValue"])]),_:1}),t.value.type==="single"?(Vue.openBlock(),Vue.createBlock(p,{key:0,label:"邀请码名称",prop:"name"},{default:Vue.withCtx(()=>[Vue.createVNode(l,{modelValue:t.value.name,"onUpdate:modelValue":u[3]||(u[3]=n=>t.value.name=n)},null,8,["modelValue"])]),_:1})):(Vue.openBlock(),Vue.createBlock(p,{key:1,label:"邀请码个数",prop:"count"},{default:Vue.withCtx(()=>[Vue.createVNode(o,{modelValue:t.value.count,"onUpdate:modelValue":u[4]||(u[4]=n=>t.value.count=n)},null,8,["modelValue"])]),_:1}))]),_:1},8,["model"])),[[f,c.value]])]),_:1},8,["modelValue"])}}}),q=Vue.defineComponent({__name:"InvCodeManagement",setup(d){const r=Vue.ref(!1),_=Vue.ref(15),m=Vue.ref(1),c=Vue.ref(),t=Vue.ref([]),V=async()=>{try{r.value=!0;const o=await T({page:m.value,size:_.value});c.value=o.data}finally{r.value=!1}},y=async o=>{o.edit=!(o.edit??!1)},N=async o=>{o.edit=!(o.edit??!0),await x(o)},x=async o=>{try{r.value=!0,await M(o),ElementPlus.ElMessage.success("修改邀请码成功")}finally{r.value=!1,await V()}},b=async o=>{try{r.value=!0,await F(o),ElementPlus.ElMessage.success("删除邀请码成功")}finally{r.value=!1,await V()}},v=async()=>{try{r.value=!0;const o=t.value.map(l=>l.id);await P(o),ElementPlus.ElMessage.success("删除邀请码成功")}finally{r.value=!1,await V()}},u=o=>t.value=o;Vue.onMounted(V);const C=Vue.ref(!1),w=()=>C.value=!C.value,p=(o=!0)=>{if(!o){I(t.value.map(a=>a.name).join(`
`));return}const l=t.value.map(a=>[a.name,a.group.count,a.group.size].join(" | "));l.unshift(["邀请码","可用次数","可下载量"].join(" | ")),I(l.join(`
`))};return(o,l)=>{var h,D,S;const a=Vue.resolveComponent("el-button"),i=Vue.resolveComponent("el-table-column"),k=Vue.resolveComponent("el-input"),f=Vue.resolveComponent("el-input-number"),n=Vue.resolveComponent("el-table"),B=Vue.resolveComponent("el-pagination"),$=Vue.resolveDirective("loading");return Vue.openBlock(),Vue.createElementBlock(Vue.Fragment,null,[Vue.createVNode(j,{onGetInvCodes:V,modelValue:C.value,"onUpdate:modelValue":l[0]||(l[0]=e=>C.value=e)},null,8,["modelValue"]),Vue.createVNode(a,{type:"primary",onClick:l[1]||(l[1]=e=>V())},{default:Vue.withCtx(()=>[Vue.createTextVNode("刷新列表")]),_:1}),Vue.createVNode(a,{type:"primary",onClick:l[2]||(l[2]=e=>w())},{default:Vue.withCtx(()=>[Vue.createTextVNode("添加邀请码")]),_:1}),Vue.createVNode(a,{type:"primary",disabled:t.value.length<=0,onClick:l[3]||(l[3]=e=>p())},{default:Vue.withCtx(()=>[Vue.createTextVNode(" 批量复制 ")]),_:1},8,["disabled"]),Vue.createVNode(a,{type:"primary",disabled:t.value.length<=0,onClick:l[4]||(l[4]=e=>p())},{default:Vue.withCtx(()=>[Vue.createTextVNode(" 批量复制(无格式) ")]),_:1},8,["disabled"]),Vue.createVNode(a,{type:"danger",disabled:t.value.length<=0,onClick:l[5]||(l[5]=e=>v())},{default:Vue.withCtx(()=>[Vue.createTextVNode(" 批量删除 ")]),_:1},8,["disabled"]),Vue.withDirectives((Vue.openBlock(),Vue.createBlock(n,{data:((h=c.value)==null?void 0:h.data)??[],border:"","show-overflow-tooltip":"",class:"table",onSelectionChange:u},{default:Vue.withCtx(()=>[Vue.createVNode(i,{type:"selection",width:"40"}),Vue.createVNode(i,{prop:"id",label:"ID"}),Vue.createVNode(i,{prop:"name",label:"邀请码名称"},{default:Vue.withCtx(({row:e})=>[Vue.withDirectives(Vue.createElementVNode("span",null,Vue.toDisplayString(e.name),513),[[Vue.vShow,!e.edit]]),Vue.withDirectives(Vue.createVNode(k,{modelValue:e.name,"onUpdate:modelValue":s=>e.name=s},null,8,["modelValue","onUpdate:modelValue"]),[[Vue.vShow,e.edit]])]),_:1}),Vue.createVNode(i,{prop:"group_id",label:"用户组ID"},{default:Vue.withCtx(({row:e})=>[Vue.withDirectives(Vue.createElementVNode("span",null,Vue.toDisplayString(e.group_id),513),[[Vue.vShow,!e.edit]]),Vue.withDirectives(Vue.createVNode(f,{modelValue:e.group_id,"onUpdate:modelValue":s=>e.group_id=s},null,8,["modelValue","onUpdate:modelValue"]),[[Vue.vShow,e.edit]])]),_:1}),Vue.createVNode(i,{prop:"can_count",label:"可用次数"},{default:Vue.withCtx(({row:e})=>[Vue.withDirectives(Vue.createElementVNode("span",null,Vue.toDisplayString(e.can_count),513),[[Vue.vShow,!e.edit]]),Vue.withDirectives(Vue.createVNode(f,{modelValue:e.can_count,"onUpdate:modelValue":s=>e.can_count=s},null,8,["modelValue","onUpdate:modelValue"]),[[Vue.vShow,e.edit]])]),_:1}),Vue.createVNode(i,{prop:"use_count",label:"已使用次数"}),Vue.createVNode(i,{prop:"created_at",label:"创建时间"},{default:Vue.withCtx(({row:e})=>[Vue.createTextVNode(Vue.toDisplayString(new Date(e.created_at).toLocaleString()),1)]),_:1}),Vue.createVNode(i,{prop:"updated_at",label:"更新时间"},{default:Vue.withCtx(({row:e})=>[Vue.createTextVNode(Vue.toDisplayString(new Date(e.updated_at).toLocaleString()),1)]),_:1}),Vue.createVNode(i,{width:"200",label:"操作",fixed:"right"},{default:Vue.withCtx(({row:e})=>[e.edit?Vue.createCommentVNode("",!0):(Vue.openBlock(),Vue.createBlock(a,{key:0,size:"small",type:"primary",onClick:s=>y(e)},{default:Vue.withCtx(()=>[Vue.createTextVNode(" 编辑 ")]),_:2},1032,["onClick"])),e.edit?(Vue.openBlock(),Vue.createBlock(a,{key:1,size:"small",type:"primary",onClick:s=>N(e)},{default:Vue.withCtx(()=>[Vue.createTextVNode(" 保存 ")]),_:2},1032,["onClick"])):Vue.createCommentVNode("",!0),Vue.createVNode(a,{size:"small",type:"primary",onClick:s=>Vue.unref(I)(e.name)},{default:Vue.withCtx(()=>[Vue.createTextVNode(" 复制 ")]),_:2},1032,["onClick"]),Vue.createVNode(a,{size:"small",type:"danger",onClick:s=>b(e)},{default:Vue.withCtx(()=>[Vue.createTextVNode("删除")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[$,r.value]]),Vue.createVNode(B,{"current-page":m.value,"onUpdate:currentPage":l[6]||(l[6]=e=>m.value=e),"page-size":_.value,"onUpdate:pageSize":l[7]||(l[7]=e=>_.value=e),"page-sizes":[15,50,100,500,((D=c.value)==null?void 0:D.total)??100],total:((S=c.value)==null?void 0:S.total)??100,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:V,onCurrentChange:V},null,8,["current-page","page-size","page-sizes","total"])],64)}}}),G=z(q,[["__scopeId","data-v-3f8aea2f"]]);export{G as default};
