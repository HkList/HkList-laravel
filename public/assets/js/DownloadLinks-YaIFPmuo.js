import{b as B,N as $,r as M,u as k,e as u,c as h,m as t,k as l,x as s,t as C,j as q,F as I,C as P,q as d,E as i,A as R,T as G,S as H,V as J,U as K,p as O}from"./.pnpm-fc_Lr1wI.js";import{i as x,a as A}from"./index-B6Bk_CPg.js";import{u as Q}from"./aria2Store-DeB8uIrB.js";import{u as W}from"./fileListStore-BGgFIpYA.js";import{c as D}from"./copy-08SGvsTk.js";const X=g=>new Promise(p=>setTimeout(p,g)),Y=d("h2",null,"链接列表",-1),Z=d("h3",null,[s("下载请推荐使用Aria2下载器,如 "),d("a",{href:"https://motrix.app/",target:"_blank"},"Motrix")],-1),w=d("h3",null,"IDM下载需要手动指定UA,点击即可复制",-1),ee=d("h3",null,"如果当前链接下载失败,请尝试更换链接,如果全部不可用可以单独重新解析单个文件",-1),oe=B({__name:"DownloadLinks",setup(g){const p=W(),{downloadLinks:_}=$(p),y=M([]),E=a=>y.value=a,F=Q(),{aria2ConfigForm:r,aria2ConfigDialogVisible:S}=$(F),v=async a=>{try{await x.post(`${r.value.host}:${r.value.port}/jsonrpc`,{jsonrpc:"2.0",id:A(),method:"aria2.getVersion",params:[`token:${r.value.token}`]})}catch{return i.error("检查 Aria2 服务状态失败")}try{await x.post(`${r.value.host}:${r.value.port}/jsonrpc`,{jsonrpc:"2.0",id:A(),method:"aria2.addUri",params:[`token:${r.value.token}`,[a.urls?a.urls[a.index]:a.url],{out:a.filename,header:[`User-Agent: ${a.ua}`]}]})}catch{return i.error("发送失败, 请检查控制台输出, 自行谷歌搜索或提交issue")}i.success(`已把${a.filename}任务发送给下载器`)},L=async()=>{i.error("请确保最大同时下载文件数在5及以下,否则可能出现下载失败!"),await X(3e3),i.success("开始下载"),y.value.forEach(a=>v(a))},U=()=>S.value=!0,b=async(a,o)=>{const n=await p.getDownloadLinks(o,!0);if(!n)return i.error("重新解析失败");_.value[a]=n[0]},V=a=>{_.value[a].index++};return(a,o)=>{const n=R,N=G,c=H,T=J,j=K,z=O;return k(_).length!==0?(u(),h(z,{key:0,class:"card"},{default:t(()=>[Y,Z,w,ee,l(N,null,{default:t(()=>[l(n,{type:"primary",disabled:y.value.length<=0,onClick:o[0]||(o[0]=e=>L())},{default:t(()=>[s(" 批量下载 ")]),_:1},8,["disabled"]),l(n,{type:"primary",onClick:o[1]||(o[1]=e=>U())},{default:t(()=>[s("下载配置")]),_:1})]),_:1}),l(j,{border:"","show-overflow-tooltip":"",class:"table",data:k(_),onSelectionChange:E},{default:t(()=>[l(c,{type:"selection",width:"40"}),l(c,{prop:"ua",label:"UA"},{default:t(({row:e})=>[l(T,{type:"danger",onClick:m=>k(D)(e.ua,"已复制UA")},{default:t(()=>[s(C(e.ua??e.url),1)]),_:2},1032,["onClick"])]),_:1}),l(c,{prop:"filename",label:"文件名"}),l(c,{prop:"url",label:"下载链接"},{default:t(({row:e})=>[s(C(e.urls?e.urls[e.index]:e.url),1)]),_:1}),l(c,{label:"操作",width:"450"},{default:t(({row:e,$index:m})=>[l(n,{type:"primary",size:"small",onClick:f=>k(D)(e.urls?e.urls[e.index]:e.url,"已将链接复制到粘贴板内")},{default:t(()=>[s(" 复制链接 ")]),_:2},1032,["onClick"]),l(n,{type:"primary",size:"small",onClick:f=>v(e)},{default:t(()=>[s(" 发送Aria2 ")]),_:2},1032,["onClick"]),e.urls?(u(),q(I,{key:0},[e.index<e.urls.length-1?(u(),h(n,{key:0,type:"danger",size:"small",onClick:f=>V(m)},{default:t(()=>[s(" 更换链接 (当前第"+C(e.index+1)+"条链接) ",1)]),_:2},1032,["onClick"])):(u(),h(n,{key:1,type:"danger",size:"small",onClick:f=>b(m,e.fs_id)},{default:t(()=>[s(" 重新解析 ")]),_:2},1032,["onClick"]))],64)):(u(),h(n,{key:1,type:"danger",size:"small",onClick:f=>b(m,e.fs_id)},{default:t(()=>[s(" 重新解析 ")]),_:2},1032,["onClick"]))]),_:1})]),_:1},8,["data"])]),_:1})):P("",!0)}}});export{oe as default};
