import{b as P,J as h,r as q,e as i,f as d,c as f,n as a,l as n,x as o,t as v,k as I,F as J,C as O,q as p,E as c,A as R,O as w,N as G,T as H,P as K,p as Q}from"./.pnpm-DVFgL_l4.js";import{u as W,i as D,a as E}from"./index-B89KlgET.js";import{u as X}from"./aria2Store-CClkT0si.js";import{u as Y}from"./fileListStore-VW611-KK.js";import{c as S}from"./copy-ZJ2NYpOM.js";const Z=b=>new Promise(k=>setTimeout(k,b)),ee=p("h2",null,"链接列表",-1),te=p("h3",null,[o("下载请推荐使用Aria2下载器,如 "),p("a",{href:"https://motrix.app/"},"Motrix")],-1),ae=p("h3",null,"IDM下载需要手动指定UA,点击即可复制",-1),ne=p("h3",null,"如果当前链接下载失败,请尝试更换链接,如果全部不可用可以单独重新解析单个文件",-1),ce=P({__name:"DownloadLinks",setup(b){const k=W(),{config:g}=h(k),$=Y(),{downloadLinks:_}=h($),y=q([]),F=t=>y.value=t,L=X(),{aria2ConfigForm:r,aria2ConfigDialogVisible:N}=h(L),x=async t=>{try{await D.post(`${r.value.host}:${r.value.port}/jsonrpc`,{jsonrpc:"2.0",id:E(),method:"aria2.getVersion",params:[`token:${r.value.token}`]})}catch{return c.error("检查 Aria2 服务状态失败")}try{await D.post(`${r.value.host}:${r.value.port}/jsonrpc`,{jsonrpc:"2.0",id:E(),method:"aria2.addUri",params:[`token:${r.value.token}`,[t.urls?t.urls[t.index]:t.url],{out:t.filename,header:[`User-Agent: ${g.value.user_agent}`]}]})}catch{return c.error("发送失败, 请检查控制台输出, 自行谷歌搜索或提交issue")}c.success(`已把${t.filename}任务发送给下载器`)},T=async()=>{c.error("请确保最大同时下载文件数在5及以下,否则可能出现下载失败!"),await Z(3e3),c.success("开始下载"),y.value.forEach(t=>x(t))},U=()=>N.value=!0,A=async(t,s)=>{const l=await $.getDownloadLinks(s,!0);if(!l)return c.error("重新解析失败");_.value[t]=l[0]},V=t=>{_.value[t].index++};return(t,s)=>{const l=R,z=w,u=G,B=H,j=K,M=Q;return i(_).length!==0?(d(),f(M,{key:0,class:"card"},{default:a(()=>[ee,te,ae,ne,n(z,null,{default:a(()=>[n(l,{type:"primary",disabled:y.value.length<=0,onClick:s[0]||(s[0]=e=>T())},{default:a(()=>[o(" 批量下载 ")]),_:1},8,["disabled"]),n(l,{type:"primary",onClick:s[1]||(s[1]=e=>U())},{default:a(()=>[o("下载配置")]),_:1})]),_:1}),n(j,{border:"","show-overflow-tooltip":"",class:"table",data:i(_),onSelectionChange:F},{default:a(()=>[n(u,{type:"selection",width:"40"}),n(u,{prop:"ua",label:"UA"},{default:a(({})=>[n(B,{type:"danger",onClick:s[2]||(s[2]=e=>i(S)(i(g).user_agent,"已复制UA"))},{default:a(()=>[o(v(i(g).user_agent),1)]),_:1})]),_:1}),n(u,{prop:"filename",label:"文件名"}),n(u,{prop:"url",label:"下载链接"},{default:a(({row:e})=>[o(v(e.urls?e.urls[e.index]:e.url),1)]),_:1}),n(u,{label:"操作",width:"450"},{default:a(({row:e,$index:C})=>[n(l,{type:"primary",size:"small",onClick:m=>i(S)(e.urls?e.urls[e.index]:e.url,"已将链接复制到粘贴板内")},{default:a(()=>[o(" 复制链接 ")]),_:2},1032,["onClick"]),n(l,{type:"primary",size:"small",onClick:m=>x(e)},{default:a(()=>[o(" 发送Aria2 ")]),_:2},1032,["onClick"]),e.urls?(d(),I(J,{key:0},[e.index<e.urls.length-1?(d(),f(l,{key:0,type:"danger",size:"small",onClick:m=>V(C)},{default:a(()=>[o(" 更换链接 (当前第"+v(e.index+1)+"条链接) ",1)]),_:2},1032,["onClick"])):(d(),f(l,{key:1,type:"danger",size:"small",onClick:m=>A(C,e.fs_id)},{default:a(()=>[o(" 重新解析 ")]),_:2},1032,["onClick"]))],64)):(d(),f(l,{key:1,type:"danger",size:"small",onClick:m=>A(C,e.fs_id)},{default:a(()=>[o(" 重新解析 ")]),_:2},1032,["onClick"]))]),_:1})]),_:1},8,["data"])]),_:1})):O("",!0)}}});export{ce as default};
