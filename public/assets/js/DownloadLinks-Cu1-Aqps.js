import{i as m,a as _}from"./index-CQGKQ7TU.js";import{u as $}from"./aria2Store-CM0pQjVP.js";import{u as D}from"./fileListStore-C9o_j5cH.js";import{c as f}from"./copy-DyHnEpWH.js";/* empty css              */const T=V=>new Promise(u=>setTimeout(u,V)),w=Vue.createElementVNode("h2",null,"链接列表",-1),A=Vue.createElementVNode("h3",null,[Vue.createTextVNode("下载请推荐使用Aria2下载器,如 "),Vue.createElementVNode("a",{href:"https://motrix.app/",target:"_blank"},"Motrix")],-1),B=Vue.createElementVNode("h3",null,"IDM下载需要手动指定UA,点击即可复制",-1),P=Vue.createElementVNode("h3",null,"如果当前链接下载失败,请尝试更换链接,如果全部不可用可以单独重新解析单个文件",-1),z=Vue.defineComponent({__name:"DownloadLinks",setup(V){const u=D(),{downloadLinks:s}=Pinia.storeToRefs(u),c=Vue.ref([]),C=t=>c.value=t,k=$(),{aria2ConfigForm:a,aria2ConfigDialogVisible:h}=Pinia.storeToRefs(k),d=async t=>{try{await m.post(`${a.value.host}:${a.value.port}/jsonrpc`,{jsonrpc:"2.0",id:_(),method:"aria2.getVersion",params:[`token:${a.value.token}`]})}catch{return ElementPlus.ElMessage.error("检查 Aria2 服务状态失败")}try{await m.post(`${a.value.host}:${a.value.port}/jsonrpc`,{jsonrpc:"2.0",id:_(),method:"aria2.addUri",params:[`token:${a.value.token}`,[t.urls?t.urls[t.index]:t.url],{out:t.filename,header:[`User-Agent: ${t.ua}`]}]})}catch{return ElementPlus.ElMessage.error("发送失败, 请检查控制台输出, 自行谷歌搜索或提交issue")}ElementPlus.ElMessage.success(`已把${t.filename}任务发送给下载器`)},x=async()=>{ElementPlus.ElMessage.error("请确保最大同时下载文件数在5及以下,否则可能出现下载失败!"),await T(3e3),ElementPlus.ElMessage.success("开始下载"),c.value.forEach(t=>d(t))},g=()=>h.value=!0,p=async(t,l)=>{const o=await u.getDownloadLinks(l,!0);if(!o)return ElementPlus.ElMessage.error("重新解析失败");s.value[t]=o[0]},N=t=>{s.value[t].index++};return(t,l)=>{const o=Vue.resolveComponent("el-button"),v=Vue.resolveComponent("el-space"),n=Vue.resolveComponent("el-table-column"),y=Vue.resolveComponent("el-link"),E=Vue.resolveComponent("el-table"),b=Vue.resolveComponent("el-card");return Vue.unref(s).length!==0?(Vue.openBlock(),Vue.createBlock(b,{key:0,class:"card"},{default:Vue.withCtx(()=>[w,A,B,P,Vue.createVNode(v,null,{default:Vue.withCtx(()=>[Vue.createVNode(o,{type:"primary",disabled:c.value.length<=0,onClick:l[0]||(l[0]=e=>x())},{default:Vue.withCtx(()=>[Vue.createTextVNode(" 批量下载 ")]),_:1},8,["disabled"]),Vue.createVNode(o,{type:"primary",onClick:l[1]||(l[1]=e=>g())},{default:Vue.withCtx(()=>[Vue.createTextVNode("下载配置")]),_:1})]),_:1}),Vue.createVNode(E,{border:"","show-overflow-tooltip":"",class:"table",data:Vue.unref(s),onSelectionChange:C},{default:Vue.withCtx(()=>[Vue.createVNode(n,{type:"selection",width:"40"}),Vue.createVNode(n,{prop:"ua",label:"UA"},{default:Vue.withCtx(({row:e})=>[Vue.createVNode(y,{type:"danger",onClick:r=>Vue.unref(f)(e.ua,"已复制UA")},{default:Vue.withCtx(()=>[Vue.createTextVNode(Vue.toDisplayString(e.ua??e.url),1)]),_:2},1032,["onClick"])]),_:1}),Vue.createVNode(n,{prop:"filename",label:"文件名"}),Vue.createVNode(n,{prop:"url",label:"下载链接"},{default:Vue.withCtx(({row:e})=>[Vue.createTextVNode(Vue.toDisplayString(e.urls?e.urls[e.index]:e.url),1)]),_:1}),Vue.createVNode(n,{label:"操作",width:"450"},{default:Vue.withCtx(({row:e,$index:r})=>[Vue.createVNode(o,{type:"primary",size:"small",onClick:i=>Vue.unref(f)(e.urls?e.urls[e.index]:e.url,"已将链接复制到粘贴板内")},{default:Vue.withCtx(()=>[Vue.createTextVNode(" 复制链接 ")]),_:2},1032,["onClick"]),Vue.createVNode(o,{type:"primary",size:"small",onClick:i=>d(e)},{default:Vue.withCtx(()=>[Vue.createTextVNode(" 发送Aria2 ")]),_:2},1032,["onClick"]),e.urls?(Vue.openBlock(),Vue.createElementBlock(Vue.Fragment,{key:0},[e.index<e.urls.length-1?(Vue.openBlock(),Vue.createBlock(o,{key:0,type:"danger",size:"small",onClick:i=>N(r)},{default:Vue.withCtx(()=>[Vue.createTextVNode(" 更换链接 (当前第"+Vue.toDisplayString(e.index+1)+"条链接) ",1)]),_:2},1032,["onClick"])):(Vue.openBlock(),Vue.createBlock(o,{key:1,type:"danger",size:"small",onClick:i=>p(r,e.fs_id)},{default:Vue.withCtx(()=>[Vue.createTextVNode(" 重新解析 ")]),_:2},1032,["onClick"]))],64)):(Vue.openBlock(),Vue.createBlock(o,{key:1,type:"danger",size:"small",onClick:i=>p(r,e.fs_id)},{default:Vue.withCtx(()=>[Vue.createTextVNode(" 重新解析 ")]),_:2},1032,["onClick"]))]),_:1})]),_:1},8,["data"])]),_:1})):Vue.createCommentVNode("",!0)}}});export{z as default};
